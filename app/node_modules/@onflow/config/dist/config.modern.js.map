{"version":3,"file":"config.modern.js","sources":["../src/index.js"],"sourcesContent":["import {\n  spawn,\n  send,\n  subscriber,\n  SUBSCRIBE,\n  UNSUBSCRIBE,\n} from \"@onflow/util-actor\"\n\nconst NAME = \"config\"\nconst PUT = \"PUT_CONFIG\"\nconst GET = \"GET_CONFIG\"\nconst UPDATE = \"UPDATE_CONFIG\"\nconst DELETE = \"DELETE_CONFIG\"\nconst WHERE = \"WHERE_CONFIG\"\nconst UPDATED = \"CONFIG/UPDATED\"\n\nconst identity = v => v\n\nconst HANDLERS = {\n  [PUT]: (ctx, _letter, {key, value}) => {\n    if (key == null) throw new Error(\"Missing 'key' for config/put.\")\n    ctx.put(key, value)\n    ctx.broadcast(UPDATED, ctx.all())\n  },\n  [GET]: (ctx, letter, {key, fallback}) => {\n    if (key == null) throw new Error(\"Missing 'key' for config/get\")\n    letter.reply(ctx.get(key, fallback))\n  },\n  [UPDATE]: (ctx, letter, {key, fn}) => {\n    if (key == null) throw new Error(\"Missing 'key' for config/update\")\n    ctx.update(key, fn || identity)\n    ctx.broadcast(UPDATED, ctx.all())\n  },\n  [DELETE]: (ctx, letter, {key}) => {\n    if (key == null) throw new Error(\"Missing 'key' for config/delete\")\n    ctx.delete(key)\n    ctx.broadcast(UPDATED, ctx.all())\n  },\n  [WHERE]: (ctx, letter, {pattern}) => {\n    if (pattern == null) throw new Error(\"Missing 'pattern' for config/where\")\n    letter.reply(ctx.where(pattern))\n  },\n  [SUBSCRIBE]: (ctx, letter) => {\n    ctx.subscribe(letter.from)\n    ctx.send(letter.from, UPDATED, ctx.all())\n  },\n  [UNSUBSCRIBE]: (ctx, letter) => {\n    ctx.unsubscribe(letter.from)\n  },\n}\n\nspawn(HANDLERS, NAME)\n\nfunction put(key, value) {\n  send(NAME, PUT, {key, value})\n  return config()\n}\n\nfunction get(key, fallback) {\n  return send(NAME, GET, {key, fallback}, {expectReply: true, timeout: 10})\n}\n\nfunction update(key, fn = identity) {\n  send(NAME, UPDATE, {key, fn})\n  return config()\n}\n\nfunction _delete(key) {\n  send(NAME, DELETE, {key})\n  return config()\n}\n\nfunction where(pattern) {\n  return send(NAME, WHERE, {pattern}, {expectReply: true, timeout: 10})\n}\n\nfunction subscribe(callback) {\n  return subscriber(NAME, () => spawn(HANDLERS, NAME), callback)\n}\n\nexport function config() {\n  return {put, get, update, delete: _delete, where, subscribe}\n}\n"],"names":["NAME","PUT","GET","UPDATED","identity","v","HANDLERS","[object Object]","ctx","_letter","key","value","Error","put","broadcast","all","letter","fallback","reply","get","UPDATE_CONFIG","fn","update","DELETE_CONFIG","delete","WHERE_CONFIG","pattern","where","SUBSCRIBE","subscribe","from","send","UNSUBSCRIBE","unsubscribe","config","expectReply","timeout","_delete","callback","subscriber","spawn"],"mappings":"qGAQA,MAAMA,EAAO,SACPC,EAAM,aACNC,EAAM,aAINC,EAAU,iBAEVC,EAAWC,GAAKA,EAEhBC,EAAW,CACfC,CAACN,GAAM,CAACO,EAAKC,GAAUC,IAAAA,EAAKC,MAAAA,MAC1B,GAAW,MAAPD,EAAa,UAAUE,MAAM,iCACjCJ,EAAIK,IAAIH,EAAKC,GACbH,EAAIM,UAAUX,EAASK,EAAIO,QAE7BR,CAACL,GAAM,CAACM,EAAKQ,GAASN,IAAAA,EAAKO,SAAAA,MACzB,GAAW,MAAPP,EAAa,UAAUE,MAAM,gCACjCI,EAAOE,MAAMV,EAAIW,IAAIT,EAAKO,KAE5BG,cAAU,CAACZ,EAAKQ,GAASN,IAAAA,EAAKW,GAAAA,MAC5B,GAAW,MAAPX,EAAa,UAAUE,MAAM,mCACjCJ,EAAIc,OAAOZ,EAAKW,GAAMjB,GACtBI,EAAIM,UAAUX,EAASK,EAAIO,QAE7BQ,cAAU,CAACf,EAAKQ,GAASN,IAAAA,MACvB,GAAW,MAAPA,EAAa,UAAUE,MAAM,mCACjCJ,EAAIgB,OAAOd,GACXF,EAAIM,UAAUX,EAASK,EAAIO,QAE7BU,aAAS,CAACjB,EAAKQ,GAASU,QAAAA,MACtB,GAAe,MAAXA,EAAiB,UAAUd,MAAM,sCACrCI,EAAOE,MAAMV,EAAImB,MAAMD,KAEzBnB,CAACqB,GAAY,CAACpB,EAAKQ,KACjBR,EAAIqB,UAAUb,EAAOc,MACrBtB,EAAIuB,KAAKf,EAAOc,KAAM3B,EAASK,EAAIO,QAErCR,CAACyB,GAAc,CAACxB,EAAKQ,KACnBR,EAAIyB,YAAYjB,EAAOc,QAM3B,SAASjB,EAAIH,EAAKC,GAEhB,OADAoB,EAAK/B,EAAMC,EAAK,CAACS,IAAAA,EAAKC,MAAAA,IACfuB,IAGT,SAASf,EAAIT,EAAKO,GAChB,OAAOc,EAAK/B,EAAME,EAAK,CAACQ,IAAAA,EAAKO,SAAAA,GAAW,CAACkB,aAAa,EAAMC,QAAS,KAGvE,SAASd,EAAOZ,EAAKW,EAAKjB,GAExB,OADA2B,EAAK/B,EApDQ,gBAoDM,CAACU,IAAAA,EAAKW,GAAAA,IAClBa,IAGT,SAASG,EAAQ3B,GAEf,OADAqB,EAAK/B,EAxDQ,gBAwDM,CAACU,IAAAA,IACbwB,IAGT,SAASP,EAAMD,GACb,OAAOK,EAAK/B,EA5DA,eA4Da,CAAC0B,QAAAA,GAAU,CAACS,aAAa,EAAMC,QAAS,KAGnE,SAASP,EAAUS,GACjB,OAAOC,EAAWvC,EAAM,IAAMwC,EAAMlC,EAAUN,GAAOsC,YAGvCJ,IACd,MAAO,CAACrB,IAAAA,EAAKM,IAAAA,EAAKG,OAAAA,EAAQE,OAAQa,EAASV,MAAAA,EAAOE,UAAAA,GA9BpDW,EAAMlC,EAAUN"}