{"version":3,"file":"decode.umd.js","sources":["../src/decode.js"],"sourcesContent":["const latestBlockDeprecationNotice = () => {\n  console.error(\n    `\n          %c@onflow/decode Deprecation Notice\n          ========================\n\n          Operating upon data of the latestBlock field of the response object is deprecated and will no longer be recognized in future releases of @onflow/decode.\n          Find out more here: https://github.com/onflow/flow-js-sdk/blob/master/packages/decode/WARNINGS.md#0001-Deprecating-latestBlock-field\n\n          =======================\n        `\n      .replace(/\\n\\s+/g, \"\\n\")\n      .trim(),\n    \"font-weight:bold;font-family:monospace;\"\n  )\n}\n\nconst decodeNumber = async (num, _, stack) => {\n  try {\n    return Number(num)\n  } catch (e) {\n    throw new Error(`Decode Number Error : ${stack.join(\".\")}`)\n  }\n}\n\nconst decodeImplicit = async i => i\n\nconst decodeVoid = async () => null\n\nconst decodeOptional = async (optional, decoders, stack) =>\n  optional ? await recurseDecode(optional, decoders, stack) : null\n\nconst decodeReference = async v => ({address: v.address, type: v.type})\n\nconst decodeArray = async (array, decoders, stack) =>\n  await Promise.all(\n    array.map(\n      v =>\n        new Promise(async res =>\n          res(await recurseDecode(v, decoders, [...stack, v.type]))\n        )\n    )\n  )\n\nconst decodeDictionary = async (dictionary, decoders, stack) =>\n  await dictionary.reduce(async (acc, v) => {\n    acc = await acc\n    acc[\n      await recurseDecode(v.key, decoders, [...stack, v.key])\n    ] = await recurseDecode(v.value, decoders, [...stack, v.key])\n    return acc\n  }, Promise.resolve({}))\n\nconst decodeComposite = async (composite, decoders, stack) => {\n  const decoded = await composite.fields.reduce(async (acc, v) => {\n    acc = await acc\n    acc[v.name] = await recurseDecode(v.value, decoders, [...stack, v.name])\n    return acc\n  }, Promise.resolve({}))\n  const decoder = composite.id && decoderLookup(decoders, composite.id)\n  return decoder ? await decoder(decoded) : decoded\n}\n\nconst defaultDecoders = {\n  UInt: decodeNumber,\n  Int: decodeNumber,\n  UInt8: decodeNumber,\n  Int8: decodeNumber,\n  UInt16: decodeNumber,\n  Int16: decodeNumber,\n  UInt32: decodeNumber,\n  Int32: decodeNumber,\n  UInt64: decodeNumber,\n  Int64: decodeNumber,\n  UInt128: decodeNumber,\n  Int128: decodeNumber,\n  UInt256: decodeNumber,\n  Int256: decodeNumber,\n  Word8: decodeNumber,\n  Word16: decodeNumber,\n  Word32: decodeNumber,\n  Word64: decodeNumber,\n  UFix64: decodeImplicit,\n  Fix64: decodeImplicit,\n  String: decodeImplicit,\n  Character: decodeImplicit,\n  Bool: decodeImplicit,\n  Address: decodeImplicit,\n  Void: decodeVoid,\n  Optional: decodeOptional,\n  Reference: decodeReference,\n  Array: decodeArray,\n  Dictionary: decodeDictionary,\n  Event: decodeComposite,\n  Resource: decodeComposite,\n  Struct: decodeComposite,\n}\n\nconst decoderLookup = (decoders, lookup) => {\n  const found = Object.keys(decoders).find(decoder => {\n    if (/^\\/.*\\/$/.test(decoder)) {\n      const reg = new RegExp(decoder.substring(1, decoder.length - 1))\n      return reg.test(lookup)\n    }\n    return decoder === lookup\n  })\n  return lookup && found && decoders[found]\n}\n\nconst recurseDecode = async (decodeInstructions, decoders, stack) => {\n  let decoder = decoderLookup(decoders, decodeInstructions.type)\n  if (!decoder)\n    throw new Error(\n      `Undefined Decoder Error: ${decodeInstructions.type}@${stack.join(\".\")}`\n    )\n  return await decoder(decodeInstructions.value, decoders, stack)\n}\n\nexport const decode = async (\n  decodeInstructions,\n  customDecoders = {},\n  stack = []\n) => {\n  let decoders = {...defaultDecoders, ...customDecoders}\n  return await recurseDecode(decodeInstructions, decoders, stack)\n}\n\nexport const decodeResponse = async (response, customDecoders = {}) => {\n  let decoders = {...defaultDecoders, ...customDecoders}\n\n  if (response.encodedData) {\n    return await decode(response.encodedData, decoders)\n  } else if (response.transaction) {\n    return {\n      ...response.transaction,\n      events: await Promise.all(response.transaction.events.map(\n        async function decodeEvents(e) {\n          return {\n            type: e.type,\n            transactionId: e.transactionId,\n            transactionIndex: e.transactionIndex,\n            eventIndex: e.eventIndex,\n            data: await decode(e.payload, decoders)\n          }\n        }\n      ))\n    }\n  } else if (response.events) {\n    return await Promise.all(response.events.map(\n        async function decodeEvents(e) {\n          return {\n            type: e.type,\n            transactionId: e.transactionId,\n            transactionIndex: e.transactionIndex,\n            eventIndex: e.eventIndex,\n            data: await decode(e.payload, decoders)\n          }\n        }\n      ))\n  } else if (response.account) {\n    return response.account\n  } else if (response.block) {\n    return response.block\n  } else if (response.latestBlock) {\n    latestBlockDeprecationNotice()\n    return response.latestBlock\n  } else if (response.transactionId) {\n    return response.transactionId\n  }\n\n  return null\n}\n"],"names":["decodeNumber","num","_","stack","Number","e","Error","join","decodeImplicit","i","decodeComposite","composite","decoders","fields","reduce","acc","v","recurseDecode","value","name","Promise","resolve","decoded","decoder","id","decoderLookup","defaultDecoders","UInt","Int","UInt8","Int8","UInt16","Int16","UInt32","Int32","UInt64","Int64","UInt128","Int128","UInt256","Int256","Word8","Word16","Word32","Word64","UFix64","Fix64","String","Character","Bool","Address","Void","Optional","optional","Reference","address","type","Array","array","all","map","res","Dictionary","dictionary","key","Event","Resource","Struct","lookup","found","Object","keys","find","test","RegExp","substring","length","decodeInstructions","decode","customDecoders","response","encodedData","transaction","events","eventIndex","transactionIndex","transactionId","payload","data","account","block","latestBlock","console","error","replace","trim","_exit2"],"mappings":"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"}