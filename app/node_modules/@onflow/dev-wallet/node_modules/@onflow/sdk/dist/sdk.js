var e=require("@onflow/interaction"),r=require("@onflow/send"),n=require("@onflow/decode"),t=require("@qvvg/templar"),o=require("@onflow/encode");function i(r){return void 0===r&&(r=[]),e.pipe(e.interaction(),r)}var u=e.pipe;function s(){return(s=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e}).apply(this,arguments)}function c(e,r){(null==r||r>e.length)&&(r=e.length);for(var n=0,t=new Array(r);n<r;n++)t[n]=e[n];return t}function a(r){return e.pipe([e.makeGetAccount,function(n){return n.accountAddr=r,e.Ok(n)}])}function f(r){return void 0===r&&(r=!1),e.pipe([e.makeGetLatestBlock,function(n){return n.block.isSealed=r,e.Ok(n)}])}var p={asArgument:function(e){return e},asInjection:function(e){return e}},l={asArgument:function(e){return e},asInjection:function(e){return e}},d=[];const m=function(){function e(){}return e.prototype.then=function(r,n){const t=new e,o=this.s;if(o){const e=1&o?r:n;if(e){try{v(t,1,e(this.v))}catch(e){v(t,2,e)}return t}return this}return this.o=function(e){try{const o=e.v;1&e.s?v(t,1,r?r(o):o):n?v(t,1,n(o)):v(t,2,o)}catch(e){v(t,2,e)}},t},e}();function v(e,r,n){if(!e.s){if(n instanceof m){if(!n.s)return void(n.o=v.bind(null,e,r));1&r&&(r=n.s),n=n.v}if(n&&n.then)return void n.then(v.bind(null,e,r),v.bind(null,e,2));e.s=r,e.v=n;const t=e.o;t&&t(e)}}function y(e){return e instanceof m&&1&e.s}const h="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));var g=function(e){return"function"==typeof e},k=function(e){return"number"==typeof e},b=function(e){return"string"==typeof e},P=function(e,r){if(!e){var n,t=new Error("INVARIANT "+r);t.stack=t.stack.split("\n").filter(function(e){return!/at invariant/.test(e)}).join("\n");for(var o=arguments.length,i=new Array(o>2?o-2:0),u=2;u<o;u++)i[u-2]=arguments[u];throw(n=console).error.apply(n,["\n\n---\n\n",t,"\n\n"].concat(i,["\n\n---\n\n"])),t}},O=function(e){return!(e.role.proposer&&!(b(e.addr)&&k(e.keyId)&&k(e.sequenceNum)&&g(e.signingFunction))||e.role.payer&&!(b(e.addr)&&k(e.keyId)&&g(e.signingFunction))||e.role.authorizer&&!(b(e.addr)&&k(e.keyId)&&g(e.signingFunction)))},x=function(e){return void 0===e&&(e=[]),e.filter(Boolean)[0]||null},I=function(e){return void 0===e&&(e=[]),e.find(function(e){return e.role.proposer})||{}},j=e.pipe([function(r){try{var n=function(){return e.Ok(r)};if(!e.isTransaction(r))return Promise.resolve(e.Ok(r));var t=function(e,r,n){if("function"==typeof e[h]){var t,o,i,u=e[h]();if(function e(n){try{for(;!(t=u.next()).done;)if((n=r(t.value))&&n.then){if(!y(n))return void n.then(e,i||(i=v.bind(null,o=new m,2)));n=n.v}o?v(o,1,n):o=n}catch(e){v(o||(o=new m),2,e)}}(),u.return){var s=function(e){try{t.done||u.return()}catch(e){}return e};if(o&&o.then)return o.then(s,function(e){throw s(e)});s()}return o}if(!("length"in e))throw new TypeError("Object is not iterable");for(var c=[],a=0;a<e.length;a++)c.push(e[a]);return function(e,r,n){var t,o,i=-1;return function n(u){try{for(;++i<e.length;)if((u=r(i))&&u.then){if(!y(u))return void u.then(n,o||(o=v.bind(null,t=new m,2)));u=u.v}t?v(t,1,u):t=u}catch(e){v(t||(t=new m),2,e)}}(),t}(c,function(e){return r(c[e])})}(Object.entries(r.accounts),function(e){var n=e[0],t=e[1];function o(){P(O(r.accounts[n]),"Account unable to fulfill role",r.accounts[n])}var i=function(){if(g(t.resolve))return Promise.resolve(t.resolve(t)).then(function(e){r.accounts[n]=e})}();return i&&i.then?i.then(o):o()});return Promise.resolve(t&&t.then?t.then(n):n())}catch(e){return Promise.reject(e)}},function(r){try{if(!e.isTransaction(r))return Promise.resolve(e.Ok(r));for(var n=function(){var e,n,i,u=o[t],c=u.addr+"|"+u.keyId;r.accounts[c]=null!=r.accounts[c]?(e=r.accounts[c],n=s({tempId:c},u),{kind:x([e.kind,n.kind]),tempId:x([e.tempId,n.tempId]),addr:x([e.addr,n.addr]),keyId:(i=[e.keyId,n.keyId],void 0===i&&(i=[]),"number"==typeof i.filter(k)[0]?i.filter(k)[0]:null),sequenceNum:"number"==typeof I([e,n]).sequenceNum?I([e,n]).sequenceNum:e.sequenceNum,signature:x([e.signature,n.signature]),signingFunction:x([e.signingFunction,n.signingFunction]),resolve:x([e.resolve,n.resolve]),role:{proposer:e.role.proposer||n.role.proposer,authorizer:e.role.authorizer||n.role.authorizer,payer:e.role.payer||n.role.payer,param:e.role.param||n.role.param}}):s({tempId:c},u),r.proposer===u.tempId&&(r.proposer=c),r.payer===u.tempId&&(r.payer=c),r.authorizations=r.authorizations.map(function(e){return e===u.tempId?c:e}),delete r.accounts[u.tempId]},t=0,o=Object.values(r.accounts);t<o.length;t++)n();for(var i=0,u=Object.values(r.accounts);i<u.length;i++){var c=u[i];P(O(c),"Account unable to fulfill roles",c)}return Promise.resolve(e.Ok(r))}catch(e){return Promise.reject(e)}}]);function S(e){return{script:e.message.cadence,refBlock:e.message.refBlock||null,gasLimit:e.message.computeLimit,arguments:e.message.arguments.map(function(r){return e.arguments[r].asArgument}),proposalKey:{address:e.accounts[e.proposer].addr,keyId:e.accounts[e.proposer].keyId,sequenceNum:e.accounts[e.proposer].sequenceNum},payer:e.accounts[e.payer].addr,authorizers:e.authorizations.map(function(r){return e.accounts[r].addr})}}var w=function(e,r,n){void 0===r&&(r=[]);try{return Promise.all(r.map(function(r){try{return Promise.resolve(e.accounts[r].signingFunction({message:n,addr:e.accounts[r].addr,keyId:e.accounts[r].keyId,roles:e.accounts[r].role,interaction:e})).then(function(n){if(n.cid=r,e.accounts[r].addr!==n.addr)throw new Error(r+" — mismatching address in composite signature");if(e.accounts[r].keyId!==n.keyId)throw new Error(r+" — mismatching keyId in composite signature");return n.sig=n.signature,n.address=n.addr,n})}catch(e){return Promise.reject(e)}}))}catch(e){return Promise.reject(e)}};function A(e,r){for(var n,t=function(e,r){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,r){if(e){if("string"==typeof e)return c(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,void 0):void 0}}(e))){n&&(e=n);var t=0;return function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}(r);!(n=t()).done;){var o=n.value;e.accounts[o.cid].signature=o.signature}return r}Object.defineProperty(exports,"isBad",{enumerable:!0,get:function(){return e.isBad}}),Object.defineProperty(exports,"isOk",{enumerable:!0,get:function(){return e.isOk}}),Object.defineProperty(exports,"pipe",{enumerable:!0,get:function(){return e.pipe}}),Object.defineProperty(exports,"why",{enumerable:!0,get:function(){return e.why}}),Object.defineProperty(exports,"send",{enumerable:!0,get:function(){return r.send}}),Object.defineProperty(exports,"decode",{enumerable:!0,get:function(){return n.decode}}),Object.defineProperty(exports,"decodeResponse",{enumerable:!0,get:function(){return n.decodeResponse}}),Object.defineProperty(exports,"cadence",{enumerable:!0,get:function(){return t.templar}}),Object.defineProperty(exports,"cdc",{enumerable:!0,get:function(){return t.templar}}),exports.arg=function(e,r){return void 0===r&&(r=l),{value:e,xform:r}},exports.args=function(r){return void 0===r&&(r=[]),e.pipe(r.map(function(r){return e.makeArgument("function"==typeof r?{resolve:r}:r)}))},exports.authorization=function(e,r,n,t){return{addr:e,signingFunction:r,keyId:n,sequenceNum:t}},exports.authorizations=function(r){return void 0===r&&(r=[]),e.pipe(r.map(function(r){return e.makeAuthorizer(s({},"function"==typeof r?{resolve:r}:r,{role:{authorizer:!0}}))}))},exports.build=i,exports.getAccount=a,exports.getBlockByHeight=function(r){return e.pipe([e.makeGetBlockByHeight,function(n){return n.block.height=r,e.Ok(n)}])},exports.getBlockById=function(r){return e.pipe([e.makeGetBlockById,function(n){return n.block.id=r,e.Ok(n)}])},exports.getEvents=function(r,n,t){return e.pipe([e.makeGetEvents,function(n){return n.events.eventType=r,e.Ok(n)},function(r){return r.events.start=n,e.Ok(r)},function(r){return r.events.end=t,e.Ok(r)}])},exports.getLatestBlock=f,exports.getTransactionStatus=function(r){return e.pipe([e.makeGetTransactionStatus,function(n){return n.transactionId=r,e.Ok(n)}])},exports.invariant=function r(){for(var n=arguments.length,t=new Array(n),o=0;o<n;o++)t[o]=arguments[o];if(t.length>1){var i=t[0],u=t[1];return r(function(e,r){var n=r.Bad;return i?(0,r.Ok)(e):n(e,u)})}var s=t[0];return function(r){return s(r,{Ok:e.Ok,Bad:e.Bad})}},exports.limit=function(r){return e.pipe([function(n){return n.message.computeLimit=r,e.Ok(n)}])},exports.param=function(e,r,n){return void 0===r&&(r=p),void 0===n&&(n=null),{key:n,value:e,xform:r}},exports.params=function(r){return void 0===r&&(r=[]),e.pipe(r.map(function(r){return e.makeParam("function"==typeof r?{resolve:r}:r)}))},exports.payer=function(r){return e.makePayer(s({},"function"==typeof r?{resolve:r}:r,{role:{payer:!0}}))},exports.ping=function(){return e.pipe([e.makePing])},exports.proposer=function(r){try{return Promise.resolve(e.makeProposer("function"==typeof r?{resolve:r,role:{proposer:!0}}:s({},r,{role:{proposer:!0}})))}catch(e){return Promise.reject(e)}},exports.ref=function(r){return e.pipe([function(n){return n.message.refBlock=r,e.Ok(n)}])},exports.resolve=u,exports.resolveAccounts=j,exports.resolveArguments=function(r){try{if(!e.isTransaction(r)&&!e.isScript(r))return Promise.resolve(e.Ok(r));var n=Object.values(r.arguments);return Promise.resolve(Promise.all(n.map(function(e){try{var r=!1,n=function(){if("function"==typeof e.resolve)return r=!0,Promise.resolve(e.resolve()).then(function(r){return s({},r,{tempId:e.tempId})})}();return Promise.resolve(n&&n.then?n.then(function(n){return r?n:e}):r?n:e)}catch(e){return Promise.reject(e)}}))).then(function(n){return n.forEach(function(e){r.arguments[e.tempId]=s({},e,{asArgument:e.xform.asArgument(e.value)})}),e.Ok(r)})}catch(e){return Promise.reject(e)}},exports.resolveParams=function(r){try{var n=function(e){if(t)return e;throw new Error("Invalid Cadence Value")},t=!1;if(!e.isTransaction(r)&&!e.isScript(r))return Promise.resolve(e.Ok(r));var o=e.get(r,"ix.cadence");if("string"==typeof o)return r.message.cadence=o,Promise.resolve(e.Ok(r));var i=function(){if("function"==typeof o){var n=Object.values(r.params);return Promise.resolve(Promise.all(n.map(function(e){try{var r=!1,n=function(){if("function"==typeof e.resolve)return r=!0,Promise.resolve(e.resolve()).then(function(r){return s({},r,{tempId:e.tempId})})}();return Promise.resolve(n&&n.then?n.then(function(n){return r?n:e}):r?n:e)}catch(e){return Promise.reject(e)}}))).then(function(n){return n.forEach(function(e){r.params[e.tempId]=e}),n=Object.fromEntries(n.filter(function(e){return null!=e.key}).map(function(e){return[e.key,e.xform.asInjection(e.value)]})),r.message.cadence=o(n),t=!0,e.Ok(r)})}}();return Promise.resolve(i&&i.then?i.then(n):n(i))}catch(e){return Promise.reject(e)}},exports.resolveProposerSequenceNumber=function(t){var o=t.node;return function(t){try{return e.isTransaction(t)?t.accounts[t.proposer].sequenceNum?Promise.resolve(e.Ok(t)):Promise.resolve(i([a(t.accounts[t.proposer].addr)])).then(function(i){return Promise.resolve(r.send(i,{node:o})).then(function(r){return Promise.resolve(n.decodeResponse(r)).then(function(r){return t.accounts[t.proposer].sequenceNum=r.keys[t.accounts[t.proposer].keyId].sequenceNumber,e.Ok(t)})})}):Promise.resolve(e.Ok(t))}catch(e){return Promise.reject(e)}}},exports.resolveRefBlockId=function(t){var o=t.node;return function(t){try{return e.isTransaction(t)?t.message.refBlock?Promise.resolve(e.Ok(t)):Promise.resolve(i([f()])).then(function(i){return Promise.resolve(r.send(i,{node:o})).then(function(r){return Promise.resolve(n.decodeResponse(r)).then(function(r){return t.message.refBlock=r.id,e.Ok(t)})})}):Promise.resolve(e.Ok(t))}catch(e){return Promise.reject(e)}}},exports.resolveSignatures=function(r){try{if(!e.isTransaction(r))return Promise.resolve(r);var n=function(e){var r=new Set(e.authorizations);r.add(e.proposer),r.delete(e.payer),r=Array.from(r);var n=new Set([e.payer]);return{insideSigners:r,outsideSigners:n=Array.from(n)}}(r),t=n.outsideSigners;return Promise.resolve(w(r,n.insideSigners,o.encodeTransactionPayload(S(r)))).then(function(e){var n=A(r,e);return Promise.resolve(w(r,t,o.encodeTransactionEnvelope(s({},S(r),{payloadSigs:n})))).then(function(e){return A(r,e),r})})}catch(e){return Promise.reject(e)}},exports.resolveValidators=function(r){try{var n=e.get(r,"ix.validators",[]);return Promise.resolve(e.pipe(r,n.map(function(r){return function(n){return r(n,{Ok:e.Ok,Bad:e.Bad})}})))}catch(e){return Promise.reject(e)}},exports.script=function(){return e.pipe([e.makeScript,e.put("ix.cadence",t.templar.apply(void 0,arguments))])},exports.transaction=function(){return e.pipe([e.makeTransaction,e.put("ix.cadence",t.templar.apply(void 0,arguments)),function(r){return r.message.computeLimit=r.message.computeLimit||10,r.message.refBlock=r.message.refBlock||null,r.authorizations=r.authorizations||d,e.Ok(r)}])},exports.validator=function(r){return e.update("ix.validators",function(e){return Array.isArray(e)?e.push(r):[r]})};
//# sourceMappingURL=sdk.js.map
