import{pipe as r,interaction as e,makeAuthorizer as n,makeGetAccount as t,Ok as o,makeGetEvents as u,makeGetLatestBlock as i,makeGetBlockById as c,makeGetBlockByHeight as s,makeGetTransactionStatus as a,makeParam as f,makeArgument as l,makeProposer as m,makePayer as d,makePing as v,makeScript as p,put as y,makeTransaction as h,update as g,Bad as P,isTransaction as b,isScript as I,get as k}from"@onflow/interaction";export{isBad,isOk,pipe,why}from"@onflow/interaction";import{send as w}from"@onflow/send";export{send}from"@onflow/send";import{decodeResponse as j}from"@onflow/decode";export{decode,decodeResponse}from"@onflow/decode";import{templar as S}from"@qvvg/templar";export{templar as cadence,templar as cdc}from"@qvvg/templar";import{encodeTransactionPayload as A,encodeTransactionEnvelope as x}from"@onflow/encode";function O(n){return void 0===n&&(n=[]),r(e(),n)}var q=r;function N(){return(N=Object.assign||function(r){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(r[t]=n[t])}return r}).apply(this,arguments)}function z(r,e){(null==e||e>r.length)&&(e=r.length);for(var n=0,t=new Array(e);n<e;n++)t[n]=r[n];return t}function B(e){return void 0===e&&(e=[]),r(e.map(function(r){return n(N({},"function"==typeof r?{resolve:r}:r,{role:{authorizer:!0}}))}))}function E(r,e,n,t){return{addr:r,signingFunction:e,keyId:n,sequenceNum:t}}function F(e){return r([t,function(r){return r.accountAddr=e,o(r)}])}function L(e,n,t){return r([u,function(r){return r.events.eventType=e,o(r)},function(r){return r.events.start=n,o(r)},function(r){return r.events.end=t,o(r)}])}function T(e){return void 0===e&&(e=!1),r([i,function(r){return r.block.isSealed=e,o(r)}])}function C(e){return r([c,function(r){return r.block.id=e,o(r)}])}function R(e){return r([s,function(r){return r.block.height=e,o(r)}])}function V(e){return r([a,function(r){return r.transactionId=e,o(r)}])}function K(e){return r([function(r){return r.message.computeLimit=e,o(r)}])}function M(e){return void 0===e&&(e=[]),r(e.map(function(r){return f("function"==typeof r?{resolve:r}:r)}))}var U={asArgument:function(r){return r},asInjection:function(r){return r}};function $(r,e,n){return void 0===e&&(e=U),void 0===n&&(n=null),{key:n,value:r,xform:e}}function D(e){return void 0===e&&(e=[]),r(e.map(function(r){return l("function"==typeof r?{resolve:r}:r)}))}var G={asArgument:function(r){return r},asInjection:function(r){return r}};function H(r,e){return void 0===e&&(e=G),{value:r,xform:e}}var J=function(r){try{return Q(r)?Promise.resolve(m({resolve:r,role:{proposer:!0}})):Promise.resolve(m(N({},r,{role:{proposer:!0}})))}catch(r){return Promise.reject(r)}},Q=function(r){return"function"==typeof r};function W(r){return d(N({},"function"==typeof r?{resolve:r}:r,{role:{payer:!0}}))}function X(){return r([v])}function Y(e){return r([function(r){return r.message.refBlock=e,o(r)}])}function Z(){return r([p,y("ix.cadence",S.apply(void 0,arguments))])}var _=[];function rr(){return r([h,y("ix.cadence",S.apply(void 0,arguments)),function(r){return r.message.computeLimit=r.message.computeLimit||10,r.message.refBlock=r.message.refBlock||null,r.authorizations=r.authorizations||_,o(r)}])}function er(r){return g("ix.validators",function(e){return Array.isArray(e)?e.push(r):[r]})}function nr(){for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];if(e.length>1){var t=e[0],u=e[1];return nr(function(r,e){var n=e.Bad;return t?(0,e.Ok)(r):n(r,u)})}var i=e[0];return function(r){return i(r,{Ok:o,Bad:P})}}const tr=function(){function r(){}return r.prototype.then=function(e,n){const t=new r,o=this.s;if(o){const r=1&o?e:n;if(r){try{or(t,1,r(this.v))}catch(r){or(t,2,r)}return t}return this}return this.o=function(r){try{const o=r.v;1&r.s?or(t,1,e?e(o):o):n?or(t,1,n(o)):or(t,2,o)}catch(r){or(t,2,r)}},t},r}();function or(r,e,n){if(!r.s){if(n instanceof tr){if(!n.s)return void(n.o=or.bind(null,r,e));1&e&&(e=n.s),n=n.v}if(n&&n.then)return void n.then(or.bind(null,r,e),or.bind(null,r,2));r.s=e,r.v=n;const t=r.o;t&&t(r)}}function ur(r){return r instanceof tr&&1&r.s}const ir="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));var cr=function(r){return"function"==typeof r},sr=function(r){return"number"==typeof r},ar=function(r){return"string"==typeof r},fr=function(r,e){if(!r){var n,t=new Error("INVARIANT "+e);t.stack=t.stack.split("\n").filter(function(r){return!/at invariant/.test(r)}).join("\n");for(var o=arguments.length,u=new Array(o>2?o-2:0),i=2;i<o;i++)u[i-2]=arguments[i];throw(n=console).error.apply(n,["\n\n---\n\n",t,"\n\n"].concat(u,["\n\n---\n\n"])),t}},lr=function(r){return!(r.role.proposer&&!(ar(r.addr)&&sr(r.keyId)&&sr(r.sequenceNum)&&cr(r.signingFunction))||r.role.payer&&!(ar(r.addr)&&sr(r.keyId)&&cr(r.signingFunction))||r.role.authorizer&&!(ar(r.addr)&&sr(r.keyId)&&cr(r.signingFunction)))},mr=function(r){return void 0===r&&(r=[]),r.filter(Boolean)[0]||null},dr=function(r){return void 0===r&&(r=[]),r.find(function(r){return r.role.proposer})||{}},vr=r([function(r){try{var e=function(){return o(r)};if(!b(r))return Promise.resolve(o(r));var n=function(r,e,n){if("function"==typeof r[ir]){var t,o,u,i=r[ir]();if(function r(n){try{for(;!(t=i.next()).done;)if((n=e(t.value))&&n.then){if(!ur(n))return void n.then(r,u||(u=or.bind(null,o=new tr,2)));n=n.v}o?or(o,1,n):o=n}catch(r){or(o||(o=new tr),2,r)}}(),i.return){var c=function(r){try{t.done||i.return()}catch(r){}return r};if(o&&o.then)return o.then(c,function(r){throw c(r)});c()}return o}if(!("length"in r))throw new TypeError("Object is not iterable");for(var s=[],a=0;a<r.length;a++)s.push(r[a]);return function(r,e,n){var t,o,u=-1;return function n(i){try{for(;++u<r.length;)if((i=e(u))&&i.then){if(!ur(i))return void i.then(n,o||(o=or.bind(null,t=new tr,2)));i=i.v}t?or(t,1,i):t=i}catch(r){or(t||(t=new tr),2,r)}}(),t}(s,function(r){return e(s[r])})}(Object.entries(r.accounts),function(e){var n=e[0],t=e[1];function o(){fr(lr(r.accounts[n]),"Account unable to fulfill role",r.accounts[n])}var u=function(){if(cr(t.resolve))return Promise.resolve(t.resolve(t)).then(function(e){r.accounts[n]=e})}();return u&&u.then?u.then(o):o()});return Promise.resolve(n&&n.then?n.then(e):e())}catch(r){return Promise.reject(r)}},function(r){try{if(!b(r))return Promise.resolve(o(r));for(var e=function(){var e,o,u,i=t[n],c=i.addr+"|"+i.keyId;r.accounts[c]=null!=r.accounts[c]?(e=r.accounts[c],o=N({tempId:c},i),{kind:mr([e.kind,o.kind]),tempId:mr([e.tempId,o.tempId]),addr:mr([e.addr,o.addr]),keyId:(u=[e.keyId,o.keyId],void 0===u&&(u=[]),"number"==typeof u.filter(sr)[0]?u.filter(sr)[0]:null),sequenceNum:"number"==typeof dr([e,o]).sequenceNum?dr([e,o]).sequenceNum:e.sequenceNum,signature:mr([e.signature,o.signature]),signingFunction:mr([e.signingFunction,o.signingFunction]),resolve:mr([e.resolve,o.resolve]),role:{proposer:e.role.proposer||o.role.proposer,authorizer:e.role.authorizer||o.role.authorizer,payer:e.role.payer||o.role.payer,param:e.role.param||o.role.param}}):N({tempId:c},i),r.proposer===i.tempId&&(r.proposer=c),r.payer===i.tempId&&(r.payer=c),r.authorizations=r.authorizations.map(function(r){return r===i.tempId?c:r}),delete r.accounts[i.tempId]},n=0,t=Object.values(r.accounts);n<t.length;n++)e();for(var u=0,i=Object.values(r.accounts);u<i.length;u++){var c=i[u];fr(lr(c),"Account unable to fulfill roles",c)}return Promise.resolve(o(r))}catch(r){return Promise.reject(r)}}]),pr=function(r){try{if(!b(r)&&!I(r))return Promise.resolve(o(r));var e=Object.values(r.arguments);return Promise.resolve(Promise.all(e.map(function(r){try{var e=!1,n=function(){if("function"==typeof r.resolve)return e=!0,Promise.resolve(r.resolve()).then(function(e){return N({},e,{tempId:r.tempId})})}();return Promise.resolve(n&&n.then?n.then(function(n){return e?n:r}):e?n:r)}catch(r){return Promise.reject(r)}}))).then(function(e){return e.forEach(function(e){r.arguments[e.tempId]=N({},e,{asArgument:e.xform.asArgument(e.value)})}),o(r)})}catch(r){return Promise.reject(r)}},yr=function(r){try{var e=function(r){if(n)return r;throw new Error("Invalid Cadence Value")},n=!1;if(!b(r)&&!I(r))return Promise.resolve(o(r));var t=k(r,"ix.cadence");if("string"==typeof t)return r.message.cadence=t,Promise.resolve(o(r));var u=function(){if("function"==typeof t){var e=Object.values(r.params);return Promise.resolve(Promise.all(e.map(function(r){try{var e=!1,n=function(){if("function"==typeof r.resolve)return e=!0,Promise.resolve(r.resolve()).then(function(e){return N({},e,{tempId:r.tempId})})}();return Promise.resolve(n&&n.then?n.then(function(n){return e?n:r}):e?n:r)}catch(r){return Promise.reject(r)}}))).then(function(e){return e.forEach(function(e){r.params[e.tempId]=e}),e=Object.fromEntries(e.filter(function(r){return null!=r.key}).map(function(r){return[r.key,r.xform.asInjection(r.value)]})),r.message.cadence=t(e),n=!0,o(r)})}}();return Promise.resolve(u&&u.then?u.then(e):e(u))}catch(r){return Promise.reject(r)}};function hr(r){return{script:r.message.cadence,refBlock:r.message.refBlock||null,gasLimit:r.message.computeLimit,arguments:r.message.arguments.map(function(e){return r.arguments[e].asArgument}),proposalKey:{address:r.accounts[r.proposer].addr,keyId:r.accounts[r.proposer].keyId,sequenceNum:r.accounts[r.proposer].sequenceNum},payer:r.accounts[r.payer].addr,authorizers:r.authorizations.map(function(e){return r.accounts[e].addr})}}var gr=function(r){try{if(!b(r))return Promise.resolve(r);var e=function(r){var e=new Set(r.authorizations);e.add(r.proposer),e.delete(r.payer),e=Array.from(e);var n=new Set([r.payer]);return{insideSigners:e,outsideSigners:n=Array.from(n)}}(r),n=e.outsideSigners;return Promise.resolve(Pr(r,e.insideSigners,A(hr(r)))).then(function(e){var t=br(r,e);return Promise.resolve(Pr(r,n,x(N({},hr(r),{payloadSigs:t})))).then(function(e){return br(r,e),r})})}catch(r){return Promise.reject(r)}},Pr=function(r,e,n){void 0===e&&(e=[]);try{return Promise.all(e.map(function(e){try{return Promise.resolve(r.accounts[e].signingFunction({message:n,addr:r.accounts[e].addr,keyId:r.accounts[e].keyId,roles:r.accounts[e].role,interaction:r})).then(function(n){if(n.cid=e,r.accounts[e].addr!==n.addr)throw new Error(e+" — mismatching address in composite signature");if(r.accounts[e].keyId!==n.keyId)throw new Error(e+" — mismatching keyId in composite signature");return n.sig=n.signature,n.address=n.addr,n})}catch(r){return Promise.reject(r)}}))}catch(r){return Promise.reject(r)}};function br(r,e){for(var n,t=function(r,e){var n;if("undefined"==typeof Symbol||null==r[Symbol.iterator]){if(Array.isArray(r)||(n=function(r,e){if(r){if("string"==typeof r)return z(r,void 0);var n=Object.prototype.toString.call(r).slice(8,-1);return"Object"===n&&r.constructor&&(n=r.constructor.name),"Map"===n||"Set"===n?Array.from(r):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?z(r,void 0):void 0}}(r))){n&&(r=n);var t=0;return function(){return t>=r.length?{done:!0}:{done:!1,value:r[t++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=r[Symbol.iterator]()).next.bind(n)}(e);!(n=t()).done;){var o=n.value;r.accounts[o.cid].signature=o.signature}return e}var Ir=function(e){try{var n=k(e,"ix.validators",[]);return Promise.resolve(r(e,n.map(function(r){return function(e){return r(e,{Ok:o,Bad:P})}})))}catch(r){return Promise.reject(r)}},kr=function(r){var e=r.node;return function(r){try{return b(r)?r.accounts[r.proposer].sequenceNum?Promise.resolve(o(r)):Promise.resolve(O([F(r.accounts[r.proposer].addr)])).then(function(n){return Promise.resolve(w(n,{node:e})).then(function(e){return Promise.resolve(j(e)).then(function(e){return r.accounts[r.proposer].sequenceNum=e.keys[r.accounts[r.proposer].keyId].sequenceNumber,o(r)})})}):Promise.resolve(o(r))}catch(r){return Promise.reject(r)}}},wr=function(r){var e=r.node;return function(r){try{return b(r)?r.message.refBlock?Promise.resolve(o(r)):Promise.resolve(O([T()])).then(function(n){return Promise.resolve(w(n,{node:e})).then(function(e){return Promise.resolve(j(e)).then(function(e){return r.message.refBlock=e.id,o(r)})})}):Promise.resolve(o(r))}catch(r){return Promise.reject(r)}}};export{H as arg,D as args,E as authorization,B as authorizations,O as build,F as getAccount,R as getBlockByHeight,C as getBlockById,L as getEvents,T as getLatestBlock,V as getTransactionStatus,nr as invariant,K as limit,$ as param,M as params,W as payer,X as ping,J as proposer,Y as ref,q as resolve,vr as resolveAccounts,pr as resolveArguments,yr as resolveParams,kr as resolveProposerSequenceNumber,wr as resolveRefBlockId,gr as resolveSignatures,Ir as resolveValidators,Z as script,rr as transaction,er as validator};
//# sourceMappingURL=sdk.modern.js.map
