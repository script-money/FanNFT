!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("@onflow/interaction"),require("@onflow/send"),require("@onflow/decode"),require("@qvvg/templar"),require("@onflow/encode")):"function"==typeof define&&define.amd?define(["exports","@onflow/interaction","@onflow/send","@onflow/decode","@qvvg/templar","@onflow/encode"],r):r((e=e||self).sdk={},e.interaction,e.send,e.decode,e.templar,e.encode)}(this,function(e,r,n,t,o,i){function u(e){return void 0===e&&(e=[]),r.pipe(r.interaction(),e)}var c=r.pipe;function a(){return(a=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e}).apply(this,arguments)}function s(e,r){(null==r||r>e.length)&&(r=e.length);for(var n=0,t=new Array(r);n<r;n++)t[n]=e[n];return t}function f(e){return r.pipe([r.makeGetAccount,function(n){return n.accountAddr=e,r.Ok(n)}])}function l(e){return void 0===e&&(e=!1),r.pipe([r.makeGetLatestBlock,function(n){return n.block.isSealed=e,r.Ok(n)}])}var d={asArgument:function(e){return e},asInjection:function(e){return e}},p={asArgument:function(e){return e},asInjection:function(e){return e}},m=[];const v=function(){function e(){}return e.prototype.then=function(r,n){const t=new e,o=this.s;if(o){const e=1&o?r:n;if(e){try{y(t,1,e(this.v))}catch(e){y(t,2,e)}return t}return this}return this.o=function(e){try{const o=e.v;1&e.s?y(t,1,r?r(o):o):n?y(t,1,n(o)):y(t,2,o)}catch(e){y(t,2,e)}},t},e}();function y(e,r,n){if(!e.s){if(n instanceof v){if(!n.s)return void(n.o=y.bind(null,e,r));1&r&&(r=n.s),n=n.v}if(n&&n.then)return void n.then(y.bind(null,e,r),y.bind(null,e,2));e.s=r,e.v=n;const t=e.o;t&&t(e)}}function h(e){return e instanceof v&&1&e.s}const g="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));var k=function(e){return"function"==typeof e},b=function(e){return"number"==typeof e},P=function(e){return"string"==typeof e},O=function(e,r){if(!e){var n,t=new Error("INVARIANT "+r);t.stack=t.stack.split("\n").filter(function(e){return!/at invariant/.test(e)}).join("\n");for(var o=arguments.length,i=new Array(o>2?o-2:0),u=2;u<o;u++)i[u-2]=arguments[u];throw(n=console).error.apply(n,["\n\n---\n\n",t,"\n\n"].concat(i,["\n\n---\n\n"])),t}},I=function(e){return!(e.role.proposer&&!(P(e.addr)&&b(e.keyId)&&b(e.sequenceNum)&&k(e.signingFunction))||e.role.payer&&!(P(e.addr)&&b(e.keyId)&&k(e.signingFunction))||e.role.authorizer&&!(P(e.addr)&&b(e.keyId)&&k(e.signingFunction)))},j=function(e){return void 0===e&&(e=[]),e.filter(Boolean)[0]||null},w=function(e){return void 0===e&&(e=[]),e.find(function(e){return e.role.proposer})||{}},S=r.pipe([function(e){try{var n=function(){return r.Ok(e)};if(!r.isTransaction(e))return Promise.resolve(r.Ok(e));var t=function(e,r,n){if("function"==typeof e[g]){var t,o,i,u=e[g]();if(function e(n){try{for(;!(t=u.next()).done;)if((n=r(t.value))&&n.then){if(!h(n))return void n.then(e,i||(i=y.bind(null,o=new v,2)));n=n.v}o?y(o,1,n):o=n}catch(e){y(o||(o=new v),2,e)}}(),u.return){var c=function(e){try{t.done||u.return()}catch(e){}return e};if(o&&o.then)return o.then(c,function(e){throw c(e)});c()}return o}if(!("length"in e))throw new TypeError("Object is not iterable");for(var a=[],s=0;s<e.length;s++)a.push(e[s]);return function(e,r,n){var t,o,i=-1;return function n(u){try{for(;++i<e.length;)if((u=r(i))&&u.then){if(!h(u))return void u.then(n,o||(o=y.bind(null,t=new v,2)));u=u.v}t?y(t,1,u):t=u}catch(e){y(t||(t=new v),2,e)}}(),t}(a,function(e){return r(a[e])})}(Object.entries(e.accounts),function(r){var n=r[0],t=r[1];function o(){O(I(e.accounts[n]),"Account unable to fulfill role",e.accounts[n])}var i=function(){if(k(t.resolve))return Promise.resolve(t.resolve(t)).then(function(r){e.accounts[n]=r})}();return i&&i.then?i.then(o):o()});return Promise.resolve(t&&t.then?t.then(n):n())}catch(e){return Promise.reject(e)}},function(e){try{if(!r.isTransaction(e))return Promise.resolve(r.Ok(e));for(var n=function(){var r,n,i,u=o[t],c=u.addr+"|"+u.keyId;e.accounts[c]=null!=e.accounts[c]?(r=e.accounts[c],n=a({tempId:c},u),{kind:j([r.kind,n.kind]),tempId:j([r.tempId,n.tempId]),addr:j([r.addr,n.addr]),keyId:(i=[r.keyId,n.keyId],void 0===i&&(i=[]),"number"==typeof i.filter(b)[0]?i.filter(b)[0]:null),sequenceNum:"number"==typeof w([r,n]).sequenceNum?w([r,n]).sequenceNum:r.sequenceNum,signature:j([r.signature,n.signature]),signingFunction:j([r.signingFunction,n.signingFunction]),resolve:j([r.resolve,n.resolve]),role:{proposer:r.role.proposer||n.role.proposer,authorizer:r.role.authorizer||n.role.authorizer,payer:r.role.payer||n.role.payer,param:r.role.param||n.role.param}}):a({tempId:c},u),e.proposer===u.tempId&&(e.proposer=c),e.payer===u.tempId&&(e.payer=c),e.authorizations=e.authorizations.map(function(e){return e===u.tempId?c:e}),delete e.accounts[u.tempId]},t=0,o=Object.values(e.accounts);t<o.length;t++)n();for(var i=0,u=Object.values(e.accounts);i<u.length;i++){var c=u[i];O(I(c),"Account unable to fulfill roles",c)}return Promise.resolve(r.Ok(e))}catch(e){return Promise.reject(e)}}]);function A(e){return{script:e.message.cadence,refBlock:e.message.refBlock||null,gasLimit:e.message.computeLimit,arguments:e.message.arguments.map(function(r){return e.arguments[r].asArgument}),proposalKey:{address:e.accounts[e.proposer].addr,keyId:e.accounts[e.proposer].keyId,sequenceNum:e.accounts[e.proposer].sequenceNum},payer:e.accounts[e.payer].addr,authorizers:e.authorizations.map(function(r){return e.accounts[r].addr})}}var B=function(e,r,n){void 0===r&&(r=[]);try{return Promise.all(r.map(function(r){try{return Promise.resolve(e.accounts[r].signingFunction({message:n,addr:e.accounts[r].addr,keyId:e.accounts[r].keyId,roles:e.accounts[r].role,interaction:e})).then(function(n){if(n.cid=r,e.accounts[r].addr!==n.addr)throw new Error(r+" — mismatching address in composite signature");if(e.accounts[r].keyId!==n.keyId)throw new Error(r+" — mismatching keyId in composite signature");return n.sig=n.signature,n.address=n.addr,n})}catch(e){return Promise.reject(e)}}))}catch(e){return Promise.reject(e)}};function q(e,r){for(var n,t=function(e,r){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,r){if(e){if("string"==typeof e)return s(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,void 0):void 0}}(e))){n&&(e=n);var t=0;return function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}(r);!(n=t()).done;){var o=n.value;e.accounts[o.cid].signature=o.signature}return r}Object.defineProperty(e,"isBad",{enumerable:!0,get:function(){return r.isBad}}),Object.defineProperty(e,"isOk",{enumerable:!0,get:function(){return r.isOk}}),Object.defineProperty(e,"pipe",{enumerable:!0,get:function(){return r.pipe}}),Object.defineProperty(e,"why",{enumerable:!0,get:function(){return r.why}}),Object.defineProperty(e,"send",{enumerable:!0,get:function(){return n.send}}),Object.defineProperty(e,"decode",{enumerable:!0,get:function(){return t.decode}}),Object.defineProperty(e,"decodeResponse",{enumerable:!0,get:function(){return t.decodeResponse}}),Object.defineProperty(e,"cadence",{enumerable:!0,get:function(){return o.templar}}),Object.defineProperty(e,"cdc",{enumerable:!0,get:function(){return o.templar}}),e.arg=function(e,r){return void 0===r&&(r=p),{value:e,xform:r}},e.args=function(e){return void 0===e&&(e=[]),r.pipe(e.map(function(e){return r.makeArgument("function"==typeof e?{resolve:e}:e)}))},e.authorization=function(e,r,n,t){return{addr:e,signingFunction:r,keyId:n,sequenceNum:t}},e.authorizations=function(e){return void 0===e&&(e=[]),r.pipe(e.map(function(e){return r.makeAuthorizer(a({},"function"==typeof e?{resolve:e}:e,{role:{authorizer:!0}}))}))},e.build=u,e.getAccount=f,e.getBlockByHeight=function(e){return r.pipe([r.makeGetBlockByHeight,function(n){return n.block.height=e,r.Ok(n)}])},e.getBlockById=function(e){return r.pipe([r.makeGetBlockById,function(n){return n.block.id=e,r.Ok(n)}])},e.getEvents=function(e,n,t){return r.pipe([r.makeGetEvents,function(n){return n.events.eventType=e,r.Ok(n)},function(e){return e.events.start=n,r.Ok(e)},function(e){return e.events.end=t,r.Ok(e)}])},e.getLatestBlock=l,e.getTransactionStatus=function(e){return r.pipe([r.makeGetTransactionStatus,function(n){return n.transactionId=e,r.Ok(n)}])},e.invariant=function e(){for(var n=arguments.length,t=new Array(n),o=0;o<n;o++)t[o]=arguments[o];if(t.length>1){var i=t[0],u=t[1];return e(function(e,r){var n=r.Bad;return i?(0,r.Ok)(e):n(e,u)})}var c=t[0];return function(e){return c(e,{Ok:r.Ok,Bad:r.Bad})}},e.limit=function(e){return r.pipe([function(n){return n.message.computeLimit=e,r.Ok(n)}])},e.param=function(e,r,n){return void 0===r&&(r=d),void 0===n&&(n=null),{key:n,value:e,xform:r}},e.params=function(e){return void 0===e&&(e=[]),r.pipe(e.map(function(e){return r.makeParam("function"==typeof e?{resolve:e}:e)}))},e.payer=function(e){return r.makePayer(a({},"function"==typeof e?{resolve:e}:e,{role:{payer:!0}}))},e.ping=function(){return r.pipe([r.makePing])},e.proposer=function(e){try{return Promise.resolve(r.makeProposer("function"==typeof e?{resolve:e,role:{proposer:!0}}:a({},e,{role:{proposer:!0}})))}catch(e){return Promise.reject(e)}},e.ref=function(e){return r.pipe([function(n){return n.message.refBlock=e,r.Ok(n)}])},e.resolve=c,e.resolveAccounts=S,e.resolveArguments=function(e){try{if(!r.isTransaction(e)&&!r.isScript(e))return Promise.resolve(r.Ok(e));var n=Object.values(e.arguments);return Promise.resolve(Promise.all(n.map(function(e){try{var r=!1,n=function(){if("function"==typeof e.resolve)return r=!0,Promise.resolve(e.resolve()).then(function(r){return a({},r,{tempId:e.tempId})})}();return Promise.resolve(n&&n.then?n.then(function(n){return r?n:e}):r?n:e)}catch(e){return Promise.reject(e)}}))).then(function(n){return n.forEach(function(r){e.arguments[r.tempId]=a({},r,{asArgument:r.xform.asArgument(r.value)})}),r.Ok(e)})}catch(e){return Promise.reject(e)}},e.resolveParams=function(e){try{var n=function(e){if(t)return e;throw new Error("Invalid Cadence Value")},t=!1;if(!r.isTransaction(e)&&!r.isScript(e))return Promise.resolve(r.Ok(e));var o=r.get(e,"ix.cadence");if("string"==typeof o)return e.message.cadence=o,Promise.resolve(r.Ok(e));var i=function(){if("function"==typeof o){var n=Object.values(e.params);return Promise.resolve(Promise.all(n.map(function(e){try{var r=!1,n=function(){if("function"==typeof e.resolve)return r=!0,Promise.resolve(e.resolve()).then(function(r){return a({},r,{tempId:e.tempId})})}();return Promise.resolve(n&&n.then?n.then(function(n){return r?n:e}):r?n:e)}catch(e){return Promise.reject(e)}}))).then(function(n){return n.forEach(function(r){e.params[r.tempId]=r}),n=Object.fromEntries(n.filter(function(e){return null!=e.key}).map(function(e){return[e.key,e.xform.asInjection(e.value)]})),e.message.cadence=o(n),t=!0,r.Ok(e)})}}();return Promise.resolve(i&&i.then?i.then(n):n(i))}catch(e){return Promise.reject(e)}},e.resolveProposerSequenceNumber=function(e){var o=e.node;return function(e){try{return r.isTransaction(e)?e.accounts[e.proposer].sequenceNum?Promise.resolve(r.Ok(e)):Promise.resolve(u([f(e.accounts[e.proposer].addr)])).then(function(i){return Promise.resolve(n.send(i,{node:o})).then(function(n){return Promise.resolve(t.decodeResponse(n)).then(function(n){return e.accounts[e.proposer].sequenceNum=n.keys[e.accounts[e.proposer].keyId].sequenceNumber,r.Ok(e)})})}):Promise.resolve(r.Ok(e))}catch(e){return Promise.reject(e)}}},e.resolveRefBlockId=function(e){var o=e.node;return function(e){try{return r.isTransaction(e)?e.message.refBlock?Promise.resolve(r.Ok(e)):Promise.resolve(u([l()])).then(function(i){return Promise.resolve(n.send(i,{node:o})).then(function(n){return Promise.resolve(t.decodeResponse(n)).then(function(n){return e.message.refBlock=n.id,r.Ok(e)})})}):Promise.resolve(r.Ok(e))}catch(e){return Promise.reject(e)}}},e.resolveSignatures=function(e){try{if(!r.isTransaction(e))return Promise.resolve(e);var n=function(e){var r=new Set(e.authorizations);r.add(e.proposer),r.delete(e.payer),r=Array.from(r);var n=new Set([e.payer]);return{insideSigners:r,outsideSigners:n=Array.from(n)}}(e),t=n.outsideSigners;return Promise.resolve(B(e,n.insideSigners,i.encodeTransactionPayload(A(e)))).then(function(r){var n=q(e,r);return Promise.resolve(B(e,t,i.encodeTransactionEnvelope(a({},A(e),{payloadSigs:n})))).then(function(r){return q(e,r),e})})}catch(e){return Promise.reject(e)}},e.resolveValidators=function(e){try{var n=r.get(e,"ix.validators",[]);return Promise.resolve(r.pipe(e,n.map(function(e){return function(n){return e(n,{Ok:r.Ok,Bad:r.Bad})}})))}catch(e){return Promise.reject(e)}},e.script=function(){return r.pipe([r.makeScript,r.put("ix.cadence",o.templar.apply(void 0,arguments))])},e.transaction=function(){return r.pipe([r.makeTransaction,r.put("ix.cadence",o.templar.apply(void 0,arguments)),function(e){return e.message.computeLimit=e.message.computeLimit||10,e.message.refBlock=e.message.refBlock||null,e.authorizations=e.authorizations||m,r.Ok(e)}])},e.validator=function(e){return r.update("ix.validators",function(r){return Array.isArray(r)?r.push(e):[e]})}});
//# sourceMappingURL=sdk.umd.js.map
