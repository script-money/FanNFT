import{invariant as e}from"@onflow/util-invariant";import{config as t}from"@onflow/config";export{config}from"@onflow/config";import{Transaction as n,SendTransactionRequest as a,AccessAPI as o,GetTransactionRequest as r,ExecuteScriptAtBlockIDRequest as s,ExecuteScriptAtBlockHeightRequest as c,ExecuteScriptAtLatestBlockRequest as i,GetAccountAtBlockHeightRequest as u,GetAccountAtLatestBlockRequest as l,GetEventsForHeightRangeRequest as d,GetEventsForBlockIDsRequest as g,GetBlockByIDRequest as f,GetBlockByHeightRequest as p,GetLatestBlockRequest as m,GetBlockHeaderByIDRequest as h,GetBlockHeaderByHeightRequest as y,GetLatestBlockHeaderRequest as k,GetCollectionByIDRequest as I,PingRequest as b}from"@onflow/protobuf";import{sansPrefix as w,withPrefix as S}from"@onflow/util-address";import{grpc as B}from"@improbable-eng/grpc-web";import{NodeHttpTransport as v}from"@improbable-eng/grpc-web-node-http-transport";import{encode as A}from"@onflow/rlp";import{template as T}from"@onflow/util-template";export{template as cadence,template as cdc}from"@onflow/util-template";function x(){return(x=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}const N='{\n  "tag":"UNKNOWN",\n  "assigns":{},\n  "status":"OK",\n  "reason":null,\n  "accounts":{},\n  "params":{},\n  "arguments":{},\n  "message": {\n    "cadence":null,\n    "refBlock":null,\n    "computeLimit":null,\n    "proposer":null,\n    "payer":null,\n    "authorizations":[],\n    "params":[],\n    "arguments":[]\n  },\n  "proposer":null,\n  "authorizations":[],\n  "payer":null,\n  "events": {\n    "eventType":null,\n    "start":null,\n    "end":null,\n    "blockIds":[]\n  },\n  "transaction": {\n    "id":null\n  },\n  "block": {\n    "id":null,\n    "height":null,\n    "isSealed":null\n  },\n  "account": {\n    "addr":null\n  },\n  "collection": {\n    "id":null\n  }\n}',E=new Set(Object.keys(JSON.parse(N))),L=()=>JSON.parse(N),O="abcdefghijklmnopqrstuvwxyz0123456789".split(""),_=()=>O[~~(Math.random()*O.length)],G=()=>Array.from({length:10},_).join(""),C=e=>null==e,U=e=>(e.status="OK",e),D=(e,t)=>(e.status="BAD",e.reason=t,e),K=e=>t=>(t.tag=e,U(t)),R=(t,n={})=>a=>{e("function"==typeof t||"object"==typeof t,"prepAccount must be passed an authorization function or an account object"),e(null!=n.role,"Account must have a role");const o=JSON.parse('{\n  "kind":"ACCOUNT",\n  "tempId":null,\n  "addr":null,\n  "keyId":null,\n  "sequenceNum":null,\n  "signature":null,\n  "signingFunction":null,\n  "resolve":null,\n  "role": {\n    "proposer":false,\n    "authorizer":false,\n    "payer":false,\n    "param":false\n  }\n}'),r=n.role,s=G();return a.accounts[s]=x({},o,{tempId:s},t="function"==typeof t?{resolve:t}:t,{role:x({},o.role,"object"==typeof t.role?t.role:{},{[r]:!0})}),"authorizer"===r?a.authorizations.push(s):a[r]=s,a},P=e=>t=>{let n=G();return t.message.arguments.push(n),t.arguments[n]=JSON.parse('{\n  "kind":"ARGUMENT",\n  "tempId":null,\n  "value":null,\n  "asArgument":null,\n  "xform":null,\n  "resolve": null\n}'),t.arguments[n].tempId=n,t.arguments[n].value=e.value,t.arguments[n].asArgument=e.asArgument,t.arguments[n].xform=e.xform,t.arguments[n].resolve=e.resolve,U(t)},H=K("SCRIPT"),j=K("TRANSACTION"),z=K("GET_TRANSACTION_STATUS"),F=K("GET_TRANSACTION"),q=K("GET_ACCOUNT"),J=K("GET_EVENTS"),$=K("GET_LATEST_BLOCK"),W=K("GET_BLOCK_BY_ID"),Y=K("GET_BLOCK_BY_HEIGHT"),M=K("PING"),V=K("GET_BLOCK"),X=K("GET_BLOCK_HEADER"),Q=K("GET_COLLECTION"),Z=e=>t=>t.tag===e,ee=Z("UNKNOWN"),te=Z("SCRIPT"),ne=Z("TRANSACTION"),ae=Z("GET_TRANSACTION_STATUS"),oe=Z("GET_TRANSACTION"),re=Z("GET_ACCOUNT"),se=Z("GET_EVENTS"),ce=Z("GET_LATEST_BLOCK"),ie=Z("GET_BLOCK_BY_ID"),ue=Z("GET_BLOCK_BY_HEIGHT"),le=Z("PING"),de=Z("GET_BLOCK"),ge=Z("GET_BLOCK_HEADER"),fe=Z("GET_COLLECTION"),pe=e=>"OK"===e.status,me=e=>"BAD"===e.status,he=e=>e.reason,ye=async(e,t=[])=>{try{if(e=(e=>{for(let t of Object.keys(e))if(!E.has(t))throw new Error(`"${t}" is an invalid root level Interaction property.`);return e})(await e),me(e))throw new Error("Interaction Error: "+e.reason);if(!t.length)return e;const[n,...a]=t,o=await n;if("function"==typeof o)return ye(o(e),a);if(C(o)||!o)return ye(e,a);if((e=>{if(null===(t=e)||"object"!=typeof t||C(e)||(e=>"number"==typeof e)(e))return!1;var t;for(let t of E)if(!e.hasOwnProperty(t))return!1;return!0})(o))return ye(o,a);throw new Error("Invalid Interaction Composition")}catch(e){throw e}},ke=(...e)=>{const[t,n]=e;return Array.isArray(t)&&null==n?e=>ke(e,t):ye(t,n)},Ie=e=>e,be=(e,t,n)=>null==e.assigns[t]?n:e.assigns[t],we=(e,t)=>n=>(n.assigns[e]=t,U(n)),Se=(e,t=Ie)=>n=>(n.assigns[e]=t(n.assigns[e],n),U(n)),Be=e=>t=>(delete t.assigns[e],U(t));function ve(e=[]){return ke(L(),e)}const Ae=()=>JSON.parse('{\n    "tag":null,\n    "transaction":null,\n    "transactionStatus":null,\n    "transactionId":null,\n    "encodedData":null,\n    "events":null,\n    "account":null,\n    "block":null,\n    "blockHeader":null,\n    "latestBlock":null,\n    "collection":null\n}');async function Te(e,t,n){return new Promise((a,o)=>{B.unary(t,{request:n,host:e,onEnd:({status:e,statusMessage:t,message:n})=>{e===B.Code.OK?a(n):o(new Error(t))}})})}B.setDefaultTransport(v());const xe=e=>Buffer.from(e,"hex"),Ne=e=>Buffer.from(e.padStart(16,0),"hex"),Ee=e=>Buffer.from(e).toString("hex"),Le=e=>Buffer.from(JSON.stringify(e),"utf8"),Oe=e=>Buffer.from(e).toString("hex"),_e=e=>Buffer.from(e).toString("hex"),Ge=e=>Buffer.from(e).toString("hex"),Ce=e=>Buffer.from(e).toString("hex"),Ue=e=>Buffer.from(e).toString("hex"),De=e=>Buffer.from(e).toString("hex"),Ke=e=>Buffer.from(e).toString("hex"),Re=e=>Buffer.from(e).toString("hex"),Pe=async(e,B={})=>{switch(B.node=B.node||await t().get("accessNode.api"),e=await e,!0){case ne(e):return B.sendTransaction?B.sendTransaction(e,B):async function(e,t={}){const r=t.unary||Te;e=await e;const s=new n;s.setScript((e=>Buffer.from(e,"utf8"))(e.message.cadence)),s.setGasLimit(e.message.computeLimit),s.setReferenceBlockId(e.message.refBlock?xe(e.message.refBlock):null),s.setPayer(Ne(w(e.accounts[e.payer].addr))),e.message.arguments.forEach(t=>s.addArguments((e=>Buffer.from(JSON.stringify(e),"utf8"))(e.arguments[t].asArgument))),e.authorizations.map(t=>e.accounts[t].addr).reduce((e,t)=>e.find(e=>e===t)?e:[...e,t],[]).forEach(e=>s.addAuthorizers(Ne(w(e))));const c=new n.ProposalKey;c.setAddress(Ne(w(e.accounts[e.proposer].addr))),c.setKeyId(e.accounts[e.proposer].keyId),c.setSequenceNumber(e.accounts[e.proposer].sequenceNum),s.setProposalKey(c);for(let t of Object.values(e.accounts))try{if(!t.role.payer&&null!=t.signature){const e=new n.Signature;e.setAddress(Ne(w(t.addr))),e.setKeyId(t.keyId),e.setSignature(xe(t.signature)),s.addPayloadSignatures(e)}}catch(n){throw console.error("Trouble applying payload signature",{acct:t,ix:e}),n}for(let t of Object.values(e.accounts))try{if(t.role.payer&&null!=t.signature){const e=new n.Signature;e.setAddress(Ne(w(t.addr))),e.setKeyId(t.keyId),e.setSignature(xe(t.signature)),s.addEnvelopeSignatures(e)}}catch(n){throw console.error("Trouble applying envelope signature",{acct:t,ix:e}),n}const i=new a;i.setTransaction(s);var u=Date.now();const l=await r(t.node,o.SendTransaction,i);var d=Date.now();let g=Ae();var f;return g.tag=e.tag,g.transactionId=(f=l.getId_asU8(),Buffer.from(f).toString("hex")),"undefined"!=typeof window&&window.dispatchEvent(new CustomEvent("FLOW::TX",{detail:{txId:g.transactionId,delta:d-u}})),g}(e,B);case ae(e):return B.sendGetTransactionStatus?B.sendGetTransactionStatus(e,B):async function(e,t={}){const n=t.unary||Te;e=await e;const a=new r;a.setId(Buffer.from(e.transaction.id,"hex"));const s=await n(t.node,o.GetTransactionResult,a);let c=s.getEventsList(),i=Ae();return i.tag=e.tag,i.transactionStatus={status:s.getStatus(),statusCode:s.getStatusCode(),errorMessage:s.getErrorMessage(),events:c.map(e=>{return{type:e.getType(),transactionId:(t=e.getTransactionId_asU8(),Buffer.from(t).toString("hex")),transactionIndex:e.getTransactionIndex(),eventIndex:e.getEventIndex(),payload:JSON.parse(Buffer.from(e.getPayload_asU8()).toString("utf8"))};var t})},i}(e,B);case oe(e):return B.sendGetTransaction?B.sendGetTransaction(e,B):async function(e,t={}){const n=t.unary||Te;e=await e;const a=new r;a.setId(Buffer.from(e.transaction.id,"hex"));const s=await n(t.node,o.GetTransaction,a);let c=Ae();c.tag=e.tag;const i=e=>({address:Ee(e.getAddress_asU8()),keyId:e.getKeyId(),signature:Ee(e.getSignature_asU8())});let u=s.getTransaction();var l;return c.transaction={script:Buffer.from(u.getScript_asU8()).toString("utf8"),args:u.getArgumentsList().map(e=>JSON.parse(Buffer.from(e).toString("utf8"))),referenceBlockId:Ee(u.getReferenceBlockId_asU8()),gasLimit:u.getGasLimit(),proposalKey:(l=u.getProposalKey(),{address:Ee(l.getAddress_asU8()),keyId:l.getKeyId(),sequenceNumber:l.getSequenceNumber()}),payer:Ee(u.getPayer_asU8()),authorizers:u.getAuthorizersList().map(Ee),payloadSignatures:u.getPayloadSignaturesList().map(i),envelopeSignatures:u.getEnvelopeSignaturesList().map(i)},c}(e,B);case te(e):return B.sendExecuteScript?B.sendExecuteScript(e,B):async function(e,t={}){const n=t.unary||Te;let a,r;if((e=await e).block.id){a=new s,a.setBlockId(Buffer.from(e.block.id,"hex"));const c=Buffer.from(e.message.cadence,"utf8");e.message.arguments.forEach(t=>a.addArguments(Le(e.arguments[t].asArgument))),a.setScript(c),r=await n(t.node,o.ExecuteScriptAtBlockID,a)}else if(e.block.height){a=new c,a.setBlockHeight(Number(e.block.height));const s=Buffer.from(e.message.cadence,"utf8");e.message.arguments.forEach(t=>a.addArguments(Le(e.arguments[t].asArgument))),a.setScript(s),r=await n(t.node,o.ExecuteScriptAtBlockHeight,a)}else{a=new i;const s=Buffer.from(e.message.cadence,"utf8");e.message.arguments.forEach(t=>a.addArguments(Le(e.arguments[t].asArgument))),a.setScript(s),r=await n(t.node,o.ExecuteScriptAtLatestBlock,a)}let u=Ae();return u.tag=e.tag,u.encodedData=JSON.parse(Buffer.from(r.getValue_asU8()).toString("utf8")),u}(e,B);case re(e):return B.sendGetAccount?B.sendGetAccount(e,B):async function(e,t={}){const n=t.unary||Te,a=(e=await e).block.height?new u:new l;var r;e.block.height&&a.setBlockHeight(Number(e.block.height)),a.setAddress((r=w(e.account.addr),Buffer.from(r.padStart(16,0),"hex")));const s=await n(t.node,e.block.height?o.GetAccountAtBlockHeight:o.GetAccountAtLatestBlock,a);let c=Ae();c.tag=e.tag;const i=s.getAccount();let d;const g=(d=i.getContractsMap())?d.getEntryList().reduce((e,t)=>x({},e,{[t[0]]:Buffer.from(t[1]||new UInt8Array).toString("utf8")}),{}):{};return c.account={address:S(Oe(i.getAddress_asU8())),balance:i.getBalance(),code:Buffer.from(i.getCode_asU8()||new UInt8Array).toString("utf8"),contracts:g,keys:i.getKeysList().map(e=>({index:e.getIndex(),publicKey:Oe(e.getPublicKey_asU8()),signAlgo:e.getSignAlgo(),hashAlgo:e.getHashAlgo(),weight:e.getWeight(),sequenceNumber:e.getSequenceNumber(),revoked:e.getRevoked()}))},c}(e,B);case se(e):return B.sendGetEvents?B.sendGetEvents(e,B):async function(e,t={}){const n=t.unary||Te;let a;const r=(e=await e).events.start?new d:new g;r.setType(e.events.eventType),e.events.start?(r.setStartHeight(Number(e.events.start)),r.setEndHeight(Number(e.events.end)),a=await n(t.node,o.GetEventsForHeightRange,r)):(e.events.blockIds.forEach(e=>r.addBlockIds(Buffer.from(e,"hex"))),a=await n(t.node,o.GetEventsForBlockIDs,r));let s=Ae();s.tag=e.tag;const c=a.getResultsList();return s.events=c.reduce((e,t)=>{const n=_e(t.getBlockId_asU8()),a=t.getBlockHeight(),o=t.getBlockTimestamp().toDate().toISOString();return t.getEventsList().forEach(t=>{e.push({blockId:n,blockHeight:a,blockTimestamp:o,type:t.getType(),transactionId:_e(t.getTransactionId_asU8()),transactionIndex:t.getTransactionIndex(),eventIndex:t.getEventIndex(),payload:JSON.parse(Buffer.from(t.getPayload_asU8()).toString("utf8"))})}),e},[]),s}(e,B);case ce(e):return B.sendGetLatestBlock?B.sendGetLatestBlock(e,B):async function(e,t={}){e=await e;const n=new m;e.latestBlock&&e.latestBlock.isSealed&&(n.setIsSealed(e.latestBlock.isSealed),console.error("\n          %c@onflow/send Deprecation Notice\n          ========================\n\n          Operating upon data of the latestBlock field of the interaction object is deprecated and will no longer be recognized in future releases of @onflow/send.\n          Find out more here: https://github.com/onflow/flow-js-sdk/blob/master/packages/send/WARNINGS.md#0001-Deprecating-latestBlock-field\n\n          =======================\n        ".replace(/\n\s+/g,"\n").trim(),"font-weight:bold;font-family:monospace;")),e.block&&e.block.isSealed&&n.setIsSealed(e.block.isSealed);const a=(await Te(t.node,o.GetLatestBlock,n)).getBlock(),r=a.getCollectionGuaranteesList(),s=a.getBlockSealsList(),c=a.getSignaturesList(),i=Ae();return i.tag=e.tag,i.block={id:Ue(a.getId_asU8()),parentId:Ue(a.getParentId_asU8()),height:a.getHeight(),timestamp:a.getTimestamp(),collectionGuarantees:r.map(e=>({collectionId:Ue(e.getCollectionId_asU8()),signatures:e.getSignaturesList()})),blockSeals:s.map(e=>({blockId:Ue(e.getBlockId_asU8()),executionReceiptId:Ue(e.getExecutionReceiptId_asU8()),executionReceiptSignatures:e.getExecutionReceiptSignaturesList(),resultApprovalSignatures:e.getResultApprovalSignaturesList()})),signatures:c},i}(e,B);case de(e):return B.sendGetBlock?B.sendGetBlock(e,B):async function(e,t={}){const n=t.unary||Te;let a,r;(e=await e).block.id?(a=new f,a.setId(Buffer.from(e.block.id,"hex")),r=await n(t.node,o.GetBlockByID,a)):e.block.height?(a=new p,a.setHeight(Number(e.block.height)),r=await n(t.node,o.GetBlockByHeight,a)):(a=new m,e.block&&e.block.isSealed&&a.setIsSealed(e.block.isSealed),r=await n(t.node,o.GetLatestBlock,a));const s=r.getBlock(),c=s.getCollectionGuaranteesList(),i=s.getBlockSealsList(),u=s.getSignaturesList().map(Ge),l=Ae();return l.tag=e.tag,l.block={id:Ge(s.getId_asU8()),parentId:Ge(s.getParentId_asU8()),height:s.getHeight(),timestamp:s.getTimestamp().toDate().toISOString(),collectionGuarantees:c.map(e=>({collectionId:Ge(e.getCollectionId_asU8()),signatures:e.getSignaturesList().map(Ge)})),blockSeals:i.map(e=>({blockId:Ge(e.getBlockId_asU8()),executionReceiptId:Ge(e.getExecutionReceiptId_asU8()),executionReceiptSignatures:e.getExecutionReceiptSignaturesList().map(Ge),resultApprovalSignatures:e.getResultApprovalSignaturesList().map(Ge)})),signatures:u},l}(e,B);case ge(e):return B.sendGetBlockHeader?B.sendGetBlockHeader(e,B):async function(e,t={}){const n=t.unary||Te;let a,r;(e=await e).block.id?(a=new h,a.setId(Buffer.from(e.block.id,"hex")),r=await n(t.node,o.GetBlockHeaderByID,a)):e.block.height?(a=new y,a.setHeight(Number(e.block.height)),r=await n(t.node,o.GetBlockHeaderByHeight,a)):(a=new k,e.block&&e.block.isSealed&&a.setIsSealed(e.block.isSealed),r=await n(t.node,o.GetLatestBlockHeader,a));const s=r.getBlock(),c=Ae();return c.tag=e.tag,c.blockHeader={id:Ce(s.getId_asU8()),parentId:Ce(s.getParentId_asU8()),height:s.getHeight(),timestamp:s.getTimestamp().toDate().toISOString()},c}(e,B);case ie(e):return B.sendGetBlockById?B.sendGetBlockById(e,B):async function(e,t={}){e=await e;const n=new f;n.setId(Buffer.from(e.block.id,"hex"));const a=(await Te(t.node,o.GetBlockByID,n)).getBlock(),r=a.getCollectionGuaranteesList(),s=a.getBlockSealsList(),c=a.getSignaturesList(),i=Ae();return i.tag=e.tag,i.block={id:De(a.getId_asU8()),parentId:De(a.getParentId_asU8()),height:a.getHeight(),timestamp:a.getTimestamp(),collectionGuarantees:r.map(e=>({collectionId:De(e.getCollectionId_asU8()),signatures:e.getSignaturesList()})),blockSeals:s.map(e=>({blockId:De(e.getBlockId_asU8()),executionReceiptId:De(e.getExecutionReceiptId_asU8()),executionReceiptSignatures:e.getExecutionReceiptSignaturesList(),resultApprovalSignatures:e.getResultApprovalSignaturesList()})),signatures:c},i}(e,B);case ue(e):return B.sendGetBlockByHeight?B.sendGetBlockByHeight(e,B):async function(e,t={}){e=await e;const n=new p;n.setHeight(Number(e.block.height));const a=(await Te(t.node,o.GetBlockByHeight,n)).getBlock(),r=a.getCollectionGuaranteesList(),s=a.getBlockSealsList(),c=a.getSignaturesList(),i=Ae();return i.tag=e.tag,i.block={id:Ke(a.getId_asU8()),parentId:Ke(a.getParentId_asU8()),height:a.getHeight(),timestamp:a.getTimestamp(),collectionGuarantees:r.map(e=>({collectionId:Ke(e.getCollectionId_asU8()),signatures:e.getSignaturesList()})),blockSeals:s.map(e=>({blockId:Ke(e.getBlockId_asU8()),executionReceiptId:Ke(e.getExecutionReceiptId_asU8()),executionReceiptSignatures:e.getExecutionReceiptSignaturesList(),resultApprovalSignatures:e.getResultApprovalSignaturesList()})),signatures:c},i}(e,B);case fe(e):return B.sendGetCollection?B.sendGetCollection(e,B):async function(e,t={}){const n=t.unary||Te;e=await e;let a=new I;a.setId(Buffer.from(e.collection.id,"hex"));const r=(await n(t.node,o.GetCollectionByID,a)).getCollection(),s=Ae();return s.tag=e.tag,s.collection={id:Re(r.getId_asU8()),transactionIds:r.getTransactionIdsList().map(Re)},s}(e,B);case le(e):return B.sendPing?B.sendPing(e,B):async function(e,t={}){const n=t.unary||Te;e=await e;const a=new b;await n(t.node,o.Ping,a);let r=Ae();return r.tag=e.tag,r}(e,B);default:return e}};function He(e=null){return ke([V,t=>(t.block.isSealed=e,U(t))])}function je(e){return ke([q,t=>(t.account.addr=w(e),U(t))])}const ze=async(e,t,n)=>{try{return Number(e)}catch(e){throw new Error("Decode Number Error : "+n.join("."))}},Fe=async e=>e,qe=async(e,t,n)=>{const a=await e.fields.reduce(async(e,a)=>((e=await e)[a.name]=await We(a.value,t,[...n,a.name]),e),Promise.resolve({})),o=e.id&&$e(t,e.id);return o?await o(a):a},Je={UInt:ze,Int:ze,UInt8:ze,Int8:ze,UInt16:ze,Int16:ze,UInt32:ze,Int32:ze,UInt64:ze,Int64:ze,UInt128:ze,Int128:ze,UInt256:ze,Int256:ze,Word8:ze,Word16:ze,Word32:ze,Word64:ze,UFix64:Fe,Fix64:Fe,String:Fe,Character:Fe,Bool:Fe,Address:Fe,Void:async()=>null,Optional:async(e,t,n)=>e?await We(e,t,n):null,Reference:async e=>({address:e.address,type:e.type}),Array:async(e,t,n)=>await Promise.all(e.map(e=>new Promise(async a=>a(await We(e,t,[...n,e.type]))))),Dictionary:async(e,t,n)=>await e.reduce(async(e,a)=>((e=await e)[await We(a.key,t,[...n,a.key])]=await We(a.value,t,[...n,a.key]),e),Promise.resolve({})),Event:qe,Resource:qe,Struct:qe},$e=(e,t)=>{const n=Object.keys(e).find(e=>/^\/.*\/$/.test(e)?new RegExp(e.substring(1,e.length-1)).test(t):e===t);return t&&n&&e[n]},We=async(e,t,n)=>{let a=$e(t,e.type);if(!a)throw new Error(`Undefined Decoder Error: ${e.type}@${n.join(".")}`);return await a(e.value,t,n)},Ye=async(e,t={},n=[])=>{let a=x({},Je,t);return await We(e,a,n)},Me=async(e,t={})=>{let n=x({},Je,t);return e.encodedData?await Ye(e.encodedData,n):e.transactionStatus?x({},e.transactionStatus,{events:await Promise.all(e.transactionStatus.events.map(async function(e){return{type:e.type,transactionId:e.transactionId,transactionIndex:e.transactionIndex,eventIndex:e.eventIndex,data:await Ye(e.payload,n)}}))}):e.transaction?e.transaction:e.events?await Promise.all(e.events.map(async function(e){return{blockId:e.blockId,blockHeight:e.blockHeight,blockTimestamp:e.blockTimestamp,type:e.type,transactionId:e.transactionId,transactionIndex:e.transactionIndex,eventIndex:e.eventIndex,data:await Ye(e.payload,n)}})):e.account?e.account:e.block?e.block:e.blockHeader?e.blockHeader:e.latestBlock?(console.error("\n          %c@onflow/decode Deprecation Notice\n          ========================\n\n          Operating upon data of the latestBlock field of the response object is deprecated and will no longer be recognized in future releases of @onflow/decode.\n          Find out more here: https://github.com/onflow/flow-js-sdk/blob/master/packages/decode/WARNINGS.md#0001-Deprecating-latestBlock-field\n\n          =======================\n        ".replace(/\n\s+/g,"\n").trim(),"font-weight:bold;font-family:monospace;"),e.latestBlock):e.transactionId?e.transactionId:e.collection?e.collection:null};function Ve(e){return async t=>ne(t)?(t.message.refBlock||(t.message.refBlock=await async function(e){var t;return t=await ke(L(),[He()]),t=await Pe(t,e),(t=await Me(t)).id}(e)),U(t)):U(t)}const Xe=e=>"function"==typeof e,Qe=e=>"string"==typeof e;async function Ze(n){if(ne(n)||te(n)){var a=be(n,"ix.cadence");e(Xe(a)||Qe(a),"Cadence needs to be a function or a string."),Xe(a)&&(a=await a({})),e(Qe(a),"Cadence needs to be a string at this point."),n.message.cadence=await t().where(/^0x/).then(e=>Object.entries(e).reduce((e,[t,n])=>e.replace(t,n),a))}return n}const et=e=>"function"==typeof e;function tt(t){return e(null!=typeof t.xform,"No type specified for argument: "+t.value),et(t.xform)?t.xform(t.value):et(t.xform.asArgument)?t.xform.asArgument(t.value):void e(!1,"Invalid Argument",t)}async function nt(e){if(ne(e)||te(e))for(let[t,n]of Object.entries(e.arguments))e.arguments[t].asArgument=tt(n);return e}const at=(e,t)=>Buffer.from(e.padStart(2*t,0),"hex"),ot=(rt=Buffer.from("FLOW-V0.0-transaction").toString("hex"),Buffer.from(rt.padEnd(64,0),"hex")).toString("hex");var rt;const st=e=>ot+e,ct=e=>at(e,8),it=e=>Buffer.from(JSON.stringify(e),"utf8"),ut=e=>Buffer.from(e,"utf8"),lt=e=>A(e).toString("hex"),dt=e=>{return pt(e),[ut(e.cadence),e.arguments.map(it),(t=e.refBlock,at(t,32)),e.computeLimit,ct(e.proposalKey.address),e.proposalKey.keyId,e.proposalKey.sequenceNum,ct(e.payer),e.authorizers.map(ct)];var t},gt=e=>{const t=ft(e);return e.payloadSigs.map(e=>({signerIndex:t.get(e.address),keyId:e.keyId,sig:e.sig})).sort((e,t)=>e.signerIndex>t.signerIndex?1:e.signerIndex<t.signerIndex?-1:e.keyId>t.keyId?1:e.keyId<t.keyId?-1:void 0).map(e=>{return[e.signerIndex,e.keyId,(t=e.sig,Buffer.from(t,"hex"))];var t})},ft=e=>{const t=new Map;let n=0;const a=e=>{t.has(e)||(t.set(e,n),n++)};return a(e.proposalKey.address),a(e.payer),e.authorizers.forEach(a),t},pt=e=>{It.forEach(t=>Bt(e,t)),bt.forEach(t=>Bt(e.proposalKey,t,"proposalKey"))},mt=e=>"number"==typeof e,ht=e=>"string"==typeof e,yt=e=>null!==e&&"object"==typeof e,kt=e=>yt(e)&&e instanceof Array,It=[{name:"cadence",check:ht},{name:"arguments",check:kt},{name:"refBlock",check:ht,defaultVal:"0"},{name:"computeLimit",check:mt},{name:"proposalKey",check:yt},{name:"payer",check:ht},{name:"authorizers",check:kt}],bt=[{name:"address",check:ht},{name:"keyId",check:mt},{name:"sequenceNum",check:mt}],wt=[{name:"payloadSigs",check:kt}],St=[{name:"address",check:ht},{name:"keyId",check:mt},{name:"sig",check:ht}],Bt=(e,t,n,a)=>{const{name:o,check:r,defaultVal:s}=t;if(null==e[o]&&null!=s&&(e[o]=s),null==e[o])throw At(o,n,a);if(!r(e[o]))throw Tt(o,n,a)},vt=(e,t,n)=>t?null==n?`${t}.${e}`:`${t}.${n}.${e}`:e,At=(e,t,n)=>new Error("Missing field "+vt(e,t,n)),Tt=(e,t,n)=>new Error("Invalid field "+vt(e,t,n));async function xt(e){if(ne(e))try{let n=Nt(e);const a=(t=Ot(e),st(lt(dt(t))));await Promise.all(n.map(Et(e,a)));let o=function(e){let t=new Set([e.payer]);return Array.from(t)}(e);const r=(e=>st(lt((e=>((e=>{wt.forEach(t=>Bt(e,t)),e.payloadSigs.forEach((e,t)=>{St.forEach(n=>Bt(e,n,"payloadSigs",t))})})(e),[dt(e),gt(e)]))(e))))(x({},Ot(e),{payloadSigs:n.map(t=>({address:e.accounts[t].addr,keyId:e.accounts[t].keyId,sig:e.accounts[t].signature}))}));await Promise.all(o.map(Et(e,r)))}catch(t){throw console.error("Signatures",t,{ix:e}),t}var t;return e}function Nt(e){let t=new Set(e.authorizations);return t.add(e.proposer),t.delete(e.payer),Array.from(t)}function Et(e,t){return async function(n){const a=e.accounts[n];if(null!=a.signature)return;const{signature:o}=await a.signingFunction(function(e,t,n){try{return{f_type:"Signable",f_vsn:"1.0.1",message:t,addr:w(e.addr),keyId:e.keyId,roles:e.role,cadence:n.message.cadence,args:n.message.arguments.map(e=>n.arguments[e].asArgument),data:{},interaction:n,voucher:Lt(n)}}catch(e){throw console.error("buildSignable",e),e}}(a,t,e));e.accounts[n].signature=o}}const Lt=e=>({cadence:e.message.cadence,refBlock:e.message.refBlock||null,computeLimit:e.message.computeLimit,arguments:e.message.arguments.map(t=>e.arguments[t].asArgument),proposalKey:{address:S(e.accounts[e.proposer].addr),keyId:e.accounts[e.proposer].keyId,sequenceNum:e.accounts[e.proposer].sequenceNum},payer:S(e.accounts[e.payer].addr),authorizers:e.authorizations.map(t=>S(e.accounts[t].addr)).reduce((e,t)=>e.find(e=>e===t)?e:[...e,t],[]),payloadSigs:Nt(e).map(t=>({address:S(e.accounts[t].addr),keyId:e.accounts[t].keyId,sig:e.accounts[t].signature}))});function Ot(e){return{cadence:e.message.cadence,refBlock:e.message.refBlock||null,computeLimit:e.message.computeLimit,arguments:e.message.arguments.map(t=>e.arguments[t].asArgument),proposalKey:{address:w(e.accounts[e.proposer].addr),keyId:e.accounts[e.proposer].keyId,sequenceNum:e.accounts[e.proposer].sequenceNum},payer:w(e.accounts[e.payer].addr),authorizers:e.authorizations.map(t=>w(e.accounts[t].addr)).reduce((e,t)=>e.find(e=>e===t)?e:[...e,t],[])}}function _t(e,t){try{return{f_type:"PreSignable",f_vsn:"1.0.1",roles:e.role,cadence:t.message.cadence,args:t.message.arguments.map(e=>t.arguments[e].asArgument),data:{},interaction:t,voucher:Lt(t)}}catch(e){throw console.error("buildPreSignable",e),e}}async function Gt(t,n,a,o=3){e(o,"Account Resolve Recursion Limit Exceeded",{ix:t,accounts:n});let r=[];for(let e of n){var s=a||e;"function"==typeof e.resolve&&(e=await e.resolve(e,_t(e,t))),Array.isArray(e)?await Gt(t,e,s,o-1):(t.accounts[e.tempId]=t.accounts[e.tempId]||e,t.accounts[e.tempId].role.proposer=t.accounts[e.tempId].role.proposer||e.role.proposer,t.accounts[e.tempId].role.payer=t.accounts[e.tempId].role.payer||e.role.payer,t.accounts[e.tempId].role.authorizer=t.accounts[e.tempId].role.authorizer||e.role.authorizer,t.accounts[e.tempId].role.proposer&&t.proposer===s.tempId&&(t.proposer=e.tempId),t.accounts[e.tempId].role.payer&&t.payer===s.tempId&&(t.payer=e.tempId),t.accounts[e.tempId].role.authorizer&&(a?r=[...r,e.tempId]:t.authorizations=t.authorizations.map(t=>t===s.tempId?e.tempId:t))),s.tempId!=e.tempId&&delete t.accounts[s.tempId]}a&&(t.authorizations=t.authorizations.map(e=>e===a.tempId?r:e).reduce((e,t)=>Array.isArray(t)?[...e,...t]:[...e,t],[]))}async function Ct(e){if(ne(e))try{await Gt(e,Object.values(e.accounts)),await Gt(e,Object.values(e.accounts))}catch(e){throw console.error("=== SAD PANDA ===\n\n",e,"\n\n=== SAD PANDA ==="),e}return e}async function Ut(e){const t=be(e,"ix.validators",[]);return ke(e,t.map(e=>t=>e(t,{Ok:U,Bad:D})))}async function Dt(e){for(let t of Object.keys(e.accounts))e.accounts[t].addr=w(e.accounts[t].addr);return e}const Kt=ke([Ze,nt,Ct,async function(e){return ne(e)&&null==e.message.refBlock&&(e.message.refBlock=(await Pe(ve([He()])).then(Me)).id),e},async function(t){if(ne(t)){var n=Object.values(t.accounts).find(e=>e.role.proposer);e(n,"Transactions require a proposer"),null==n.sequenceNum&&(t.accounts[n.tempId].sequenceNum=await Pe(await ve([je(n.addr)])).then(Me).then(e=>e.keys).then(e=>e.find(e=>e.index===n.keyId)).then(e=>e.sequenceNumber))}return t},xt,Dt,Ut]),Rt=async(e=[],n={})=>{const a=await t().get("sdk.send",n.send||Pe),o=await t().get("sdk.resolve",n.resolve||Kt);return Array.isArray(e)&&(e=ke(L(),e)),a(await o(e),n)};async function Pt(e){const n=await t().where(/^decoder\./),a=Object.entries(n).map(([e,t])=>[e=`/${e.replace(/^decoder\./,"")}$/`,t]);return Me(e,Object.fromEntries(a))}function Ht(...e){let t=e[1]||("object"==typeof e[0]?e[0]:void 0),n="boolean"==typeof e[0]?e[0]:void 0;return"object"==typeof e[0]&&console.warn("\n      %cFCL/SDK Deprecation Notice\n      ============================\n  \n      Passing options as the first arguement to the latestBlock function has been deprecated and will be removed in future versions of the Flow JS-SDK/FCL.\n      You can learn more (including a guide on common transition paths) here: https://github.com/onflow/flow-js-sdk/blob/master/packages/sdk/TRANSITIONS.md#0007-deprecate-opts-first-arg-latest-block\n  \n      ============================\n    ","font-weight:bold;font-family:monospace;"),Rt([He(n)],t).then(Me)}function jt(e,t){return Rt([je(e)],t).then(Me)}function zt(e=[]){return ke(e.map(e=>R(e,{role:"authorizer"})))}function Ft(e,t,n,a){return{addr:e,signingFunction:t,keyId:n,sequenceNum:a}}function qt(e){return Se("ix.validators",t=>Array.isArray(t)?t.push(e):[e])}function Jt(e){return ke([t=>(t.block.height=e,t),qt(e=>{if("boolean"==typeof e.block.isSealed)throw new Error("Unable to specify both block height and isSealed.");if(e.block.id)throw new Error("Unable to specify both block height and block id.");return e})])}function $t(e){return ke([t=>(t.block.id=e,U(t)),qt((e,{Ok:t,Bad:n})=>re(e)?n(e,"Unable to specify a block id with a Get Account interaction."):"boolean"==typeof e.block.isSealed?n(e,"Unable to specify both block id and isSealed."):e.block.height?n(e,"Unable to specify both block id and block height."):t(e))])}function Wt(e,t,n){return void 0===t&&void 0===n||console.warn("\n      %cFCL/SDK Deprecation Notice\n      ============================\n  \n      Passing a start and end into getEnvents has been deprecated and will not be supported in future versions of the Flow JS-SDK/FCL.\n      You can learn more (including a guide on common transition paths) here: https://github.com/onflow/flow-js-sdk/blob/master/packages/sdk/TRANSITIONS.md#0005-deprecate-start-end-get-events-builder\n  \n      ============================\n    ","font-weight:bold;font-family:monospace;"),ke([J,a=>(a.events.eventType=e,a.events.start=t,a.events.end=n,U(a))])}function Yt(e,t,n){return ke([J,a=>(a.events.eventType=e,a.events.start=t,a.events.end=n,U(a))])}function Mt(e,t=[]){return ke([J,n=>(n.events.eventType=e,n.events.blockIds=t,U(n))])}function Vt(e=null){return ke([X,t=>(t.block.isSealed=e,U(t))])}function Xt(e=!1){return console.warn("\n    %cFCL/SDK Deprecation Notice\n    ============================\n\n    The getLatestBlock builder has been deprecated and will be removed in future versions of the Flow JS-SDK/FCL.\n    You can learn more (including a guide on common transition paths) here: https://github.com/onflow/flow-js-sdk/blob/master/packages/sdk/TRANSITIONS.md#0006-deprecate-get-latest-block-builder\n\n    ============================\n  ","font-weight:bold;font-family:monospace;"),ke([$,t=>(t.block.isSealed=e,U(t))])}function Qt(e){return console.warn("\n    %cFCL/SDK Deprecation Notice\n    ============================\n\n    The getBlockById builder has been deprecated and will be removed in future versions of the Flow JS-SDK/FCL.\n    You can learn more (including a guide on common transition paths) here: https://github.com/onflow/flow-js-sdk/blob/master/packages/sdk/TRANSITIONS.md#0004-deprecate-get-block-by-id-builder\n\n    ============================\n  ","font-weight:bold;font-family:monospace;"),ke([W,t=>(t.block.ids=[e],U(t))])}function Zt(e){return console.warn("\n    %cFCL/SDK Deprecation Notice\n    ============================\n\n    The getBlockByHeight builder has been deprecated and will be removed in future versions of the Flow JS-SDK/FCL.\n    You can learn more (including a guide on common transition paths) here: https://github.com/onflow/flow-js-sdk/blob/master/packages/sdk/TRANSITIONS.md#0003-deprecate-get-block-by-height-builder\n\n    ============================\n  ","font-weight:bold;font-family:monospace;"),ke([Y,t=>(t.block.height=e,U(t))])}function en(e=null){return ke([Q,t=>(t.collection.id=e,t)])}function tn(e){return ke([z,t=>(t.transaction.id=e,U(t))])}function nn(e){return ke([F,t=>(t.transaction.id=e,U(t))])}function an(e){return t=>(t.message.computeLimit=e,t)}function on(e=[]){return ke(e.map(P))}function rn(e,t){return{value:e,xform:t}}async function sn(e){return R(e,{role:"proposer"})}async function cn(e){return R(e,{role:"payer"})}function un(){return M}function ln(e){return ke([t=>(t.message.refBlock=e,U(t))])}function dn(...e){return ke([H,we("ix.cadence",T(...e))])}const gn=[];function fn(...e){return ke([j,we("ix.cadence",T(...e)),e=>(e.message.computeLimit=e.message.computeLimit||10,e.message.refBlock=e.message.refBlock||null,e.authorizations=e.authorizations||gn,U(e))])}function pn(...e){if(e.length>1){const[t,n]=e;return pn((e,{Ok:a,Bad:o})=>t?a(e):o(e,n))}const[t]=e;return e=>t(e,{Ok:U,Bad:D})}const mn=({node:e})=>async t=>{if(!ne(t))return U(t);if(t.accounts[t.proposer].sequenceNum)return U(t);const n=await Pe(await ve([je(t.accounts[t.proposer].addr)]),{node:e}),a=await Me(n);return t.accounts[t.proposer].sequenceNum=a.keys[t.accounts[t.proposer].keyId].sequenceNumber,U(t)},hn=e=>{(({name:e,transitionsPath:t})=>{console.error(`\n    %cFCL/SDK Deprecation Notice\n    ============================\n    The ${e} builder has been removed from the Flow JS-SDK/FCL.\n    You can learn more (including a guide on common transition paths) here: ${t}\n    ============================\n  `,"font-weight:bold;font-family:monospace;")})({name:"params",transitionsPath:"https://github.com/onflow/flow-js-sdk/blob/master/packages/sdk/TRANSITIONS.md#0001-deprecate-params"})},yn=e=>(({name:e,transitionsPath:t})=>{console.warn(`\n    %cFCL/SDK Deprecation Notice\n    ============================\n    The ${e} builder has been deprecated and will be removed in future versions of the Flow JS-SDK/FCL.\n    You can learn more (including a guide on common transition paths) here: ${t}\n    ============================\n  `,"font-weight:bold;font-family:monospace;")})({name:"param",transitionsPath:"https://github.com/onflow/flow-js-sdk/blob/master/packages/sdk/TRANSITIONS.md#0001-deprecate-params"});export{jt as account,rn as arg,on as args,Jt as atBlockHeight,$t as atBlockId,Ft as authorization,zt as authorizations,ve as build,Lt as createSignableVoucher,Pt as decode,Be as destroy,be as get,je as getAccount,He as getBlock,Zt as getBlockByHeight,Qt as getBlockById,Vt as getBlockHeader,en as getCollection,Wt as getEvents,Yt as getEventsAtBlockHeightRange,Mt as getEventsAtBlockIds,Xt as getLatestBlock,nn as getTransaction,tn as getTransactionStatus,L as interaction,pn as invariant,me as isBad,re as isGetAccount,de as isGetBlock,ue as isGetBlockByHeight,ie as isGetBlockById,ge as isGetBlockHeader,fe as isGetCollection,se as isGetEvents,ce as isGetLatestBlock,oe as isGetTransaction,ae as isGetTransactionStatus,pe as isOk,le as isPing,te as isScript,ne as isTransaction,ee as isUnknown,Ht as latestBlock,an as limit,yn as param,hn as params,cn as payer,un as ping,ke as pipe,sn as proposer,we as put,ln as ref,Kt as resolve,Ct as resolveAccounts,nt as resolveArguments,Ze as resolveCadence,Dt as resolveFinalNormalization,mn as resolveProposerSequenceNumber,Ve as resolveRefBlockId,xt as resolveSignatures,Ut as resolveValidators,dn as script,Rt as send,fn as transaction,Se as update,qt as validator,he as why};
//# sourceMappingURL=sdk.modern.js.map
