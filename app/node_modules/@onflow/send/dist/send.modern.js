import{isPing as e,isGetBlockByHeight as t,isGetBlockById as r,isGetLatestBlock as n,isGetEvents as o,isGetAccount as s,isScript as a,isGetTransactionStatus as i,isTransaction as c}from"@onflow/interaction";import{Transaction as u,SendTransactionRequest as g,AccessAPI as l,GetTransactionRequest as d,ExecuteScriptAtLatestBlockRequest as f,GetAccountRequest as m,GetEventsForHeightRangeRequest as p,GetLatestBlockRequest as v,GetBlockByIDRequest as h,GetBlockByHeightRequest as S,PingRequest as I}from"@onflow/protobuf";import{response as y}from"@onflow/response";import{grpc as k}from"@improbable-eng/grpc-web";import{NodeHttpTransport as B}from"@improbable-eng/grpc-web-node-http-transport";var P=function(e,t,r){try{return Promise.resolve(new Promise(function(n,o){k.unary(t,{request:r,host:e,onEnd:function(e){var t=e.statusMessage;e.status===k.Code.OK?n(e.message):o(new Error(t))}})}))}catch(e){return Promise.reject(e)}};k.setDefaultTransport(B());var b=function(e){return Buffer.from(e,"hex")},x=function(e){return Buffer.from(e.padStart(16,0),"hex")},w=function(e){return Buffer.from(e).toString("hex")},L=function(e){return Buffer.from(e).toString("hex")},A=function(e){return Buffer.from(e).toString("hex")},U=function(e){return Buffer.from(e).toString("hex")},_=function(k,B){void 0===B&&(B={});try{switch(!0){case c(k):return Promise.resolve(function(e,t){void 0===t&&(t={});try{var r=new u;r.setScript(Buffer.from(e.message.cadence,"utf8")),r.setGasLimit(e.message.computeLimit),r.setReferenceBlockId(e.message.refBlock?b(e.message.refBlock):null),r.setPayer(x(e.accounts[e.payer].addr)),e.message.arguments.forEach(function(t){return r.addArguments(function(e){return Buffer.from(JSON.stringify(e),"utf8")}(e.arguments[t].asArgument))}),e.authorizations.forEach(function(t){return r.addAuthorizers(x(e.accounts[t].addr))});var n=new u.ProposalKey;n.setAddress(x(e.accounts[e.proposer].addr)),n.setKeyId(e.accounts[e.proposer].keyId),n.setSequenceNumber(e.accounts[e.proposer].sequenceNum),r.setProposalKey(n),e.authorizations.forEach(function(t){if(null!==e.accounts[t].signature&&!e.accounts[t].role.payer){var n=new u.Signature;n.setAddress(x(e.accounts[t].addr)),n.setKeyId(e.accounts[t].keyId),n.setSignature(b(e.accounts[t].signature)),r.addPayloadSignatures(n)}});var o=new u.Signature;o.setAddress(x(e.accounts[e.payer].addr)),o.setKeyId(e.accounts[e.payer].keyId),o.setSignature(b(e.accounts[e.payer].signature)),r.addEnvelopeSignatures(o);var s=new g;return s.setTransaction(r),Promise.resolve(P(t.node,l.SendTransaction,s)).then(function(t){var r,n=y();return n.tag=e.tag,n.transactionId=(r=t.getId_asU8(),Buffer.from(r).toString("hex")),n})}catch(e){return Promise.reject(e)}}(k,B));case i(k):return Promise.resolve(function(e,t){void 0===t&&(t={});try{var r=new d;return r.setId(Buffer.from(e.transactionId,"hex")),Promise.resolve(P(t.node,l.GetTransactionResult,r)).then(function(t){var r=t.getEventsList(),n=y();return n.tag=e.tag,n.transaction={status:t.getStatus(),statusCode:t.getStatusCode(),errorMessage:t.getErrorMessage(),events:r.map(function(e){return{type:e.getType(),transactionId:(t=e.getTransactionId_asU8(),Buffer.from(t).toString("hex")),transactionIndex:e.getTransactionIndex(),eventIndex:e.getEventIndex(),payload:JSON.parse(Buffer.from(e.getPayload_asU8()).toString("utf8"))};var t})},n})}catch(e){return Promise.reject(e)}}(k,B));case a(k):return Promise.resolve(function(e,t){void 0===t&&(t={});try{var r=new f,n=Buffer.from(e.message.cadence,"utf8");return e.message.arguments.forEach(function(t){return r.addArguments(function(e){return Buffer.from(JSON.stringify(e),"utf8")}(e.arguments[t].asArgument))}),r.setScript(n),Promise.resolve(P(t.node,l.ExecuteScriptAtLatestBlock,r)).then(function(t){var r=y();return r.tag=e.tag,r.encodedData=JSON.parse(Buffer.from(t.getValue_asU8()).toString("utf8")),r})}catch(e){return Promise.reject(e)}}(k,B));case s(k):return Promise.resolve(function(e,t){void 0===t&&(t={});try{var r=new m;return r.setAddress(Buffer.from(e.accountAddr.padStart(16,0),"hex")),Promise.resolve(P(t.node,l.GetAccount,r)).then(function(t){var r=y();r.tag=e.tag;var n=t.getAccount();return r.account={address:w(n.getAddress_asU8()),balance:n.getBalance(),code:n.getCode_asU8(),keys:n.getKeysList().map(function(e){return{index:e.getIndex(),publicKey:w(e.getPublicKey_asU8()),signAlgo:e.getSignAlgo(),hashAlgo:e.getHashAlgo(),weight:e.getWeight(),sequenceNumber:e.getSequenceNumber()}})},r})}catch(e){return Promise.reject(e)}}(k,B));case o(k):return Promise.resolve(function(e,t){void 0===t&&(t={});try{var r=new p;return r.setType(e.events.eventType),r.setStartHeight(Number(e.events.start)),r.setEndHeight(Number(e.events.end)),Promise.resolve(P(t.node,l.GetEventsForHeightRange,r)).then(function(t){var r=y();r.tag=e.tag;var n=t.getResultsList();return r.events=n.reduce(function(e,t){var r=t.getBlockId(),n=t.getBlockHeight();return t.getEventsList().forEach(function(t){var o;e.push({blockId:r,blockHeight:n,type:t.getType(),transactionId:(o=t.getTransactionId_asU8(),Buffer.from(o).toString("hex")),transactionIndex:t.getTransactionIndex(),eventIndex:t.getEventIndex(),payload:JSON.parse(Buffer.from(t.getPayload_asU8()).toString("utf8"))})}),e},[]),r})}catch(e){return Promise.reject(e)}}(k,B));case n(k):return Promise.resolve(function(e,t){void 0===t&&(t={});try{var r=new v;return e.latestBlock&&e.latestBlock.isSealed&&(r.setIsSealed(e.latestBlock.isSealed),console.error("\n          %c@onflow/send Deprecation Notice\n          ========================\n\n          Operating upon data of the latestBlock field of the interaction object is deprecated and will no longer be recognized in future releases of @onflow/send.\n          Find out more here: https://github.com/onflow/flow-js-sdk/blob/master/packages/send/WARNINGS.md#0001-Deprecating-latestBlock-field\n\n          =======================\n        ".replace(/\n\s+/g,"\n").trim(),"font-weight:bold;font-family:monospace;")),e.block&&e.block.isSealed&&r.setIsSealed(e.block.isSealed),Promise.resolve(P(t.node,l.GetLatestBlock,r)).then(function(t){var r=t.getBlock(),n=r.getCollectionGuaranteesList(),o=r.getBlockSealsList(),s=r.getSignaturesList(),a=y();return a.tag=e.tag,a.block={id:L(r.getId_asU8()),parentId:L(r.getParentId_asU8()),height:r.getHeight(),timestamp:r.getTimestamp(),collectionGuarantees:n.map(function(e){return{collectionId:L(e.getCollectionId_asU8()),signatures:e.getSignaturesList()}}),blockSeals:o.map(function(e){return{blockId:L(e.getBlockId_asU8()),executionReceiptId:L(e.getExecutionReceiptId_asU8()),executionReceiptSignatures:e.getExecutionReceiptSignaturesList(),resultApprovalSignatures:e.getResultApprovalSignaturesList()}}),signatures:s},a})}catch(e){return Promise.reject(e)}}(k,B));case r(k):return Promise.resolve(function(e,t){void 0===t&&(t={});try{var r=new h;return r.setId(Buffer.from(e.block.id,"hex")),Promise.resolve(P(t.node,l.GetBlockByID,r)).then(function(t){var r=t.getBlock(),n=r.getCollectionGuaranteesList(),o=r.getBlockSealsList(),s=r.getSignaturesList(),a=y();return a.tag=e.tag,a.block={id:A(r.getId_asU8()),parentId:A(r.getParentId_asU8()),height:r.getHeight(),timestamp:r.getTimestamp(),collectionGuarantees:n.map(function(e){return{collectionId:A(e.getCollectionId_asU8()),signatures:e.getSignaturesList()}}),blockSeals:o.map(function(e){return{blockId:A(e.getBlockId_asU8()),executionReceiptId:A(e.getExecutionReceiptId_asU8()),executionReceiptSignatures:e.getExecutionReceiptSignaturesList(),resultApprovalSignatures:e.getResultApprovalSignaturesList()}}),signatures:s},a})}catch(e){return Promise.reject(e)}}(k,B));case t(k):return Promise.resolve(function(e,t){void 0===t&&(t={});try{var r=new S;return r.setHeight(e.block.height),Promise.resolve(P(t.node,l.GetBlockByHeight,r)).then(function(t){var r=t.getBlock(),n=r.getCollectionGuaranteesList(),o=r.getBlockSealsList(),s=r.getSignaturesList(),a=y();return a.tag=e.tag,a.block={id:U(r.getId_asU8()),parentId:U(r.getParentId_asU8()),height:r.getHeight(),timestamp:r.getTimestamp(),collectionGuarantees:n.map(function(e){return{collectionId:U(e.getCollectionId_asU8()),signatures:e.getSignaturesList()}}),blockSeals:o.map(function(e){return{blockId:U(e.getBlockId_asU8()),executionReceiptId:U(e.getExecutionReceiptId_asU8()),executionReceiptSignatures:e.getExecutionReceiptSignaturesList(),resultApprovalSignatures:e.getResultApprovalSignaturesList()}}),signatures:s},a})}catch(e){return Promise.reject(e)}}(k,B));case e(k):return Promise.resolve(function(e,t){void 0===t&&(t={});try{var r=new I;return Promise.resolve(P(t.node,l.Ping,r)).then(function(t){var r=y();return r.tag=e.tag,r})}catch(e){return Promise.reject(e)}}(k,B));default:return Promise.resolve(k)}}catch(e){return Promise.reject(e)}};export{_ as send};
//# sourceMappingURL=send.modern.js.map
