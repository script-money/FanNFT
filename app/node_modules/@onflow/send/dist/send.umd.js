!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@onflow/interaction"),require("@onflow/protobuf"),require("@onflow/response"),require("@improbable-eng/grpc-web"),require("@improbable-eng/grpc-web-node-http-transport")):"function"==typeof define&&define.amd?define(["exports","@onflow/interaction","@onflow/protobuf","@onflow/response","@improbable-eng/grpc-web","@improbable-eng/grpc-web-node-http-transport"],t):t((e=e||self).send={},e.interaction,e.protobuf,e.response,e.grpcWeb,e.grpcWebNodeHttpTransport)}(this,function(e,t,r,n,s,o){var a=function(e,t,r){try{return Promise.resolve(new Promise(function(n,o){s.grpc.unary(t,{request:r,host:e,onEnd:function(e){var t=e.statusMessage;e.status===s.grpc.Code.OK?n(e.message):o(new Error(t))}})}))}catch(e){return Promise.reject(e)}};s.grpc.setDefaultTransport(o.NodeHttpTransport());var i=function(e){return Buffer.from(e,"hex")},c=function(e){return Buffer.from(e.padStart(16,0),"hex")},u=function(e){return Buffer.from(e).toString("hex")},g=function(e){return Buffer.from(e).toString("hex")},l=function(e){return Buffer.from(e).toString("hex")},d=function(e){return Buffer.from(e).toString("hex")};e.send=function(e,s){void 0===s&&(s={});try{switch(!0){case t.isTransaction(e):return Promise.resolve(function(e,t){void 0===t&&(t={});try{var s=new r.Transaction;s.setScript(Buffer.from(e.message.cadence,"utf8")),s.setGasLimit(e.message.computeLimit),s.setReferenceBlockId(e.message.refBlock?i(e.message.refBlock):null),s.setPayer(c(e.accounts[e.payer].addr)),e.message.arguments.forEach(function(t){return s.addArguments(function(e){return Buffer.from(JSON.stringify(e),"utf8")}(e.arguments[t].asArgument))}),e.authorizations.forEach(function(t){return s.addAuthorizers(c(e.accounts[t].addr))});var o=new r.Transaction.ProposalKey;o.setAddress(c(e.accounts[e.proposer].addr)),o.setKeyId(e.accounts[e.proposer].keyId),o.setSequenceNumber(e.accounts[e.proposer].sequenceNum),s.setProposalKey(o),e.authorizations.forEach(function(t){if(null!==e.accounts[t].signature&&!e.accounts[t].role.payer){var n=new r.Transaction.Signature;n.setAddress(c(e.accounts[t].addr)),n.setKeyId(e.accounts[t].keyId),n.setSignature(i(e.accounts[t].signature)),s.addPayloadSignatures(n)}});var u=new r.Transaction.Signature;u.setAddress(c(e.accounts[e.payer].addr)),u.setKeyId(e.accounts[e.payer].keyId),u.setSignature(i(e.accounts[e.payer].signature)),s.addEnvelopeSignatures(u);var g=new r.SendTransactionRequest;return g.setTransaction(s),Promise.resolve(a(t.node,r.AccessAPI.SendTransaction,g)).then(function(t){var r,s=n.response();return s.tag=e.tag,s.transactionId=(r=t.getId_asU8(),Buffer.from(r).toString("hex")),s})}catch(e){return Promise.reject(e)}}(e,s));case t.isGetTransactionStatus(e):return Promise.resolve(function(e,t){void 0===t&&(t={});try{var s=new r.GetTransactionRequest;return s.setId(Buffer.from(e.transactionId,"hex")),Promise.resolve(a(t.node,r.AccessAPI.GetTransactionResult,s)).then(function(t){var r=t.getEventsList(),s=n.response();return s.tag=e.tag,s.transaction={status:t.getStatus(),statusCode:t.getStatusCode(),errorMessage:t.getErrorMessage(),events:r.map(function(e){return{type:e.getType(),transactionId:(t=e.getTransactionId_asU8(),Buffer.from(t).toString("hex")),transactionIndex:e.getTransactionIndex(),eventIndex:e.getEventIndex(),payload:JSON.parse(Buffer.from(e.getPayload_asU8()).toString("utf8"))};var t})},s})}catch(e){return Promise.reject(e)}}(e,s));case t.isScript(e):return Promise.resolve(function(e,t){void 0===t&&(t={});try{var s=new r.ExecuteScriptAtLatestBlockRequest,o=Buffer.from(e.message.cadence,"utf8");return e.message.arguments.forEach(function(t){return s.addArguments(function(e){return Buffer.from(JSON.stringify(e),"utf8")}(e.arguments[t].asArgument))}),s.setScript(o),Promise.resolve(a(t.node,r.AccessAPI.ExecuteScriptAtLatestBlock,s)).then(function(t){var r=n.response();return r.tag=e.tag,r.encodedData=JSON.parse(Buffer.from(t.getValue_asU8()).toString("utf8")),r})}catch(e){return Promise.reject(e)}}(e,s));case t.isGetAccount(e):return Promise.resolve(function(e,t){void 0===t&&(t={});try{var s=new r.GetAccountRequest;return s.setAddress(Buffer.from(e.accountAddr.padStart(16,0),"hex")),Promise.resolve(a(t.node,r.AccessAPI.GetAccount,s)).then(function(t){var r=n.response();r.tag=e.tag;var s=t.getAccount();return r.account={address:u(s.getAddress_asU8()),balance:s.getBalance(),code:s.getCode_asU8(),keys:s.getKeysList().map(function(e){return{index:e.getIndex(),publicKey:u(e.getPublicKey_asU8()),signAlgo:e.getSignAlgo(),hashAlgo:e.getHashAlgo(),weight:e.getWeight(),sequenceNumber:e.getSequenceNumber()}})},r})}catch(e){return Promise.reject(e)}}(e,s));case t.isGetEvents(e):return Promise.resolve(function(e,t){void 0===t&&(t={});try{var s=new r.GetEventsForHeightRangeRequest;return s.setType(e.events.eventType),s.setStartHeight(Number(e.events.start)),s.setEndHeight(Number(e.events.end)),Promise.resolve(a(t.node,r.AccessAPI.GetEventsForHeightRange,s)).then(function(t){var r=n.response();r.tag=e.tag;var s=t.getResultsList();return r.events=s.reduce(function(e,t){var r=t.getBlockId(),n=t.getBlockHeight();return t.getEventsList().forEach(function(t){var s;e.push({blockId:r,blockHeight:n,type:t.getType(),transactionId:(s=t.getTransactionId_asU8(),Buffer.from(s).toString("hex")),transactionIndex:t.getTransactionIndex(),eventIndex:t.getEventIndex(),payload:JSON.parse(Buffer.from(t.getPayload_asU8()).toString("utf8"))})}),e},[]),r})}catch(e){return Promise.reject(e)}}(e,s));case t.isGetLatestBlock(e):return Promise.resolve(function(e,t){void 0===t&&(t={});try{var s=new r.GetLatestBlockRequest;return e.latestBlock&&e.latestBlock.isSealed&&(s.setIsSealed(e.latestBlock.isSealed),console.error("\n          %c@onflow/send Deprecation Notice\n          ========================\n\n          Operating upon data of the latestBlock field of the interaction object is deprecated and will no longer be recognized in future releases of @onflow/send.\n          Find out more here: https://github.com/onflow/flow-js-sdk/blob/master/packages/send/WARNINGS.md#0001-Deprecating-latestBlock-field\n\n          =======================\n        ".replace(/\n\s+/g,"\n").trim(),"font-weight:bold;font-family:monospace;")),e.block&&e.block.isSealed&&s.setIsSealed(e.block.isSealed),Promise.resolve(a(t.node,r.AccessAPI.GetLatestBlock,s)).then(function(t){var r=t.getBlock(),s=r.getCollectionGuaranteesList(),o=r.getBlockSealsList(),a=r.getSignaturesList(),i=n.response();return i.tag=e.tag,i.block={id:g(r.getId_asU8()),parentId:g(r.getParentId_asU8()),height:r.getHeight(),timestamp:r.getTimestamp(),collectionGuarantees:s.map(function(e){return{collectionId:g(e.getCollectionId_asU8()),signatures:e.getSignaturesList()}}),blockSeals:o.map(function(e){return{blockId:g(e.getBlockId_asU8()),executionReceiptId:g(e.getExecutionReceiptId_asU8()),executionReceiptSignatures:e.getExecutionReceiptSignaturesList(),resultApprovalSignatures:e.getResultApprovalSignaturesList()}}),signatures:a},i})}catch(e){return Promise.reject(e)}}(e,s));case t.isGetBlockById(e):return Promise.resolve(function(e,t){void 0===t&&(t={});try{var s=new r.GetBlockByIDRequest;return s.setId(Buffer.from(e.block.id,"hex")),Promise.resolve(a(t.node,r.AccessAPI.GetBlockByID,s)).then(function(t){var r=t.getBlock(),s=r.getCollectionGuaranteesList(),o=r.getBlockSealsList(),a=r.getSignaturesList(),i=n.response();return i.tag=e.tag,i.block={id:l(r.getId_asU8()),parentId:l(r.getParentId_asU8()),height:r.getHeight(),timestamp:r.getTimestamp(),collectionGuarantees:s.map(function(e){return{collectionId:l(e.getCollectionId_asU8()),signatures:e.getSignaturesList()}}),blockSeals:o.map(function(e){return{blockId:l(e.getBlockId_asU8()),executionReceiptId:l(e.getExecutionReceiptId_asU8()),executionReceiptSignatures:e.getExecutionReceiptSignaturesList(),resultApprovalSignatures:e.getResultApprovalSignaturesList()}}),signatures:a},i})}catch(e){return Promise.reject(e)}}(e,s));case t.isGetBlockByHeight(e):return Promise.resolve(function(e,t){void 0===t&&(t={});try{var s=new r.GetBlockByHeightRequest;return s.setHeight(e.block.height),Promise.resolve(a(t.node,r.AccessAPI.GetBlockByHeight,s)).then(function(t){var r=t.getBlock(),s=r.getCollectionGuaranteesList(),o=r.getBlockSealsList(),a=r.getSignaturesList(),i=n.response();return i.tag=e.tag,i.block={id:d(r.getId_asU8()),parentId:d(r.getParentId_asU8()),height:r.getHeight(),timestamp:r.getTimestamp(),collectionGuarantees:s.map(function(e){return{collectionId:d(e.getCollectionId_asU8()),signatures:e.getSignaturesList()}}),blockSeals:o.map(function(e){return{blockId:d(e.getBlockId_asU8()),executionReceiptId:d(e.getExecutionReceiptId_asU8()),executionReceiptSignatures:e.getExecutionReceiptSignaturesList(),resultApprovalSignatures:e.getResultApprovalSignaturesList()}}),signatures:a},i})}catch(e){return Promise.reject(e)}}(e,s));case t.isPing(e):return Promise.resolve(function(e,t){void 0===t&&(t={});try{var s=new r.PingRequest;return Promise.resolve(a(t.node,r.AccessAPI.Ping,s)).then(function(t){var r=n.response();return r.tag=e.tag,r})}catch(e){return Promise.reject(e)}}(e,s));default:return Promise.resolve(e)}}catch(e){return Promise.reject(e)}}});
//# sourceMappingURL=send.umd.js.map
